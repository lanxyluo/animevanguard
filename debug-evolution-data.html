<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Guide æ•°æ®æµè°ƒè¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .data-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        
        .success {
            color: #28a745;
            font-weight: bold;
        }
        
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Evolution Guide æ•°æ®æµè°ƒè¯•</h1>
        
        <div class="debug-section">
            <h3>ğŸ“Š æ•°æ®æºæ£€æŸ¥</h3>
            <button class="btn" onclick="checkDataSources()">æ£€æŸ¥æ•°æ®æº</button>
            <div id="dataSourcesResult" class="data-display">ç‚¹å‡»æŒ‰é’®æ£€æŸ¥æ•°æ®æº...</div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ”„ æ•°æ®æµè¿½è¸ª</h3>
            <button class="btn" onclick="traceDataFlow()">è¿½è¸ªæ•°æ®æµ</button>
            <div id="dataFlowResult" class="data-display">ç‚¹å‡»æŒ‰é’®è¿½è¸ªæ•°æ®æµ...</div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ¯ ç­›é€‰å™¨æµ‹è¯•</h3>
            <button class="btn" onclick="testFilters()">æµ‹è¯•ç­›é€‰å™¨</button>
            <div id="filterTestResult" class="data-display">ç‚¹å‡»æŒ‰é’®æµ‹è¯•ç­›é€‰å™¨...</div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ› é—®é¢˜è¯Šæ–­</h3>
            <button class="btn" onclick="diagnoseIssues()">è¯Šæ–­é—®é¢˜</button>
            <div id="diagnosisResult" class="data-display">ç‚¹å‡»æŒ‰é’®è¯Šæ–­é—®é¢˜...</div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿæ•°æ®æº
        const mockUnitsData = [
            {
                id: "goku_ultra_instinct",
                name: "Goku (Ultra Instinct)",
                rarity: "Mythic",
                element: "Energy",
                evolution: "Ultra Instinct Mastery"
            },
            {
                id: "saitama",
                name: "Saitama",
                rarity: "Mythic",
                element: "Physical",
                evolution: "One Punch Man"
            },
            {
                id: "goku_base",
                name: "Goku",
                rarity: "Legendary",
                element: "Energy",
                evolution: "Super Saiyan Blue"
            },
            {
                id: "naruto_base",
                name: "Naruto",
                rarity: "Legendary",
                element: "Wind",
                evolution: "Six Paths Sage Mode"
            },
            {
                id: "tanjiro",
                name: "Tanjiro",
                rarity: "Epic",
                element: "Water",
                evolution: "Sun Breathing"
            }
        ];

        const mockEvolutionData = {
            "goku_ultra_instinct": {
                name: "Goku (Ultra Instinct)",
                rarity: "Mythic",
                element: "Energy",
                evolutionName: "Ultra Instinct Mastery"
            },
            "saitama": {
                name: "Saitama",
                rarity: "Mythic",
                element: "Physical",
                evolutionName: "One Punch Man"
            }
        };

        // æ£€æŸ¥æ•°æ®æº
        window.checkDataSources = function() {
            const result = document.getElementById('dataSourcesResult');
            let output = '';
            
            try {
                // æ£€æŸ¥ unitsData
                output += '<h4>ğŸ“‹ Units Data æ£€æŸ¥:</h4>';
                output += `<p>æ€»å•ä½æ•°: ${mockUnitsData.length}</p>`;
                output += `<p>å¯è¿›åŒ–å•ä½æ•°: ${mockUnitsData.filter(u => ['Rare', 'Epic', 'Legendary', 'Mythic'].includes(u.rarity)).length}</p>`;
                
                // æ£€æŸ¥ç¨€æœ‰åº¦åˆ†å¸ƒ
                const rarityCount = {};
                mockUnitsData.forEach(unit => {
                    rarityCount[unit.rarity] = (rarityCount[unit.rarity] || 0) + 1;
                });
                output += '<p>ç¨€æœ‰åº¦åˆ†å¸ƒ:</p>';
                output += '<ul>';
                Object.entries(rarityCount).forEach(([rarity, count]) => {
                    output += `<li>${rarity}: ${count}ä¸ª</li>`;
                });
                output += '</ul>';
                
                // æ£€æŸ¥å…ƒç´ åˆ†å¸ƒ
                const elementCount = {};
                mockUnitsData.forEach(unit => {
                    elementCount[unit.element] = (elementCount[unit.element] || 0) + 1;
                });
                output += '<p>å…ƒç´ åˆ†å¸ƒ:</p>';
                output += '<ul>';
                Object.entries(elementCount).forEach(([element, count]) => {
                    output += `<li>${element}: ${count}ä¸ª</li>`;
                });
                output += '</ul>';
                
                output += '<p class="success">âœ… æ•°æ®æºæ£€æŸ¥å®Œæˆ</p>';
                
            } catch (error) {
                output += `<p class="error">âŒ æ•°æ®æºæ£€æŸ¥å¤±è´¥: ${error.message}</p>`;
            }
            
            result.innerHTML = output;
        };

        // è¿½è¸ªæ•°æ®æµ
        window.traceDataFlow = function() {
            const result = document.getElementById('dataFlowResult');
            let output = '';
            
            try {
                output += '<h4>ğŸ”„ æ•°æ®æµè¿½è¸ª:</h4>';
                
                // æ­¥éª¤1: è¿‡æ»¤å¯è¿›åŒ–å•ä½
                output += '<p><strong>æ­¥éª¤1: è¿‡æ»¤å¯è¿›åŒ–å•ä½</strong></p>';
                const evolvableUnits = mockUnitsData.filter(unit => {
                    const unitId = unit.id;
                    const hasEvolutionData = mockEvolutionData[unitId] !== undefined;
                    const canEvolveByRarity = ['Rare', 'Epic', 'Legendary', 'Mythic'].includes(unit.rarity);
                    
                    output += `<p>  - ${unit.name}: hasEvolutionData=${hasEvolutionData}, canEvolveByRarity=${canEvolveByRarity}</p>`;
                    
                    return hasEvolutionData || canEvolveByRarity;
                });
                
                output += `<p>ç»“æœ: æ‰¾åˆ° ${evolvableUnits.length} ä¸ªå¯è¿›åŒ–å•ä½</p>`;
                
                // æ­¥éª¤2: ä¼ é€’ç»™UnitSelector
                output += '<p><strong>æ­¥éª¤2: ä¼ é€’ç»™UnitSelector</strong></p>';
                output += `<p>ä¼ é€’çš„å•ä½æ•°æ®: ${JSON.stringify(evolvableUnits.map(u => ({ name: u.name, rarity: u.rarity, element: u.element })), null, 2)}</p>`;
                
                // æ­¥éª¤3: ç­›é€‰é€»è¾‘
                output += '<p><strong>æ­¥éª¤3: ç­›é€‰é€»è¾‘</strong></p>';
                const testRarity = "Mythic";
                const testElement = "Energy";
                
                const filteredUnits = evolvableUnits.filter(unit => {
                    const rarityMatch = unit.rarity === testRarity;
                    const elementMatch = unit.element === testElement;
                    
                    output += `<p>  - ${unit.name}: rarityMatch=${rarityMatch} (${unit.rarity} === ${testRarity}), elementMatch=${elementMatch} (${unit.element} === ${testElement})</p>`;
                    
                    return rarityMatch && elementMatch;
                });
                
                output += `<p>ç­›é€‰ç»“æœ: æ‰¾åˆ° ${filteredUnits.length} ä¸ªåŒ¹é…å•ä½</p>`;
                
                output += '<p class="success">âœ… æ•°æ®æµè¿½è¸ªå®Œæˆ</p>';
                
            } catch (error) {
                output += `<p class="error">âŒ æ•°æ®æµè¿½è¸ªå¤±è´¥: ${error.message}</p>`;
            }
            
            result.innerHTML = output;
        };

        // æµ‹è¯•ç­›é€‰å™¨
        window.testFilters = function() {
            const result = document.getElementById('filterTestResult');
            let output = '';
            
            try {
                output += '<h4>ğŸ¯ ç­›é€‰å™¨æµ‹è¯•:</h4>';
                
                // æµ‹è¯•ä¸åŒçš„ç­›é€‰ç»„åˆ
                const testCases = [
                    { rarity: "Mythic", element: "Energy", description: "Mythic + Energy" },
                    { rarity: "Mythic", element: "Physical", description: "Mythic + Physical" },
                    { rarity: "Legendary", element: "Energy", description: "Legendary + Energy" },
                    { rarity: "Epic", element: "Water", description: "Epic + Water" },
                    { rarity: "", element: "", description: "æ— ç­›é€‰æ¡ä»¶" }
                ];
                
                testCases.forEach(testCase => {
                    output += `<p><strong>æµ‹è¯•: ${testCase.description}</strong></p>`;
                    
                    const filteredUnits = mockUnitsData.filter(unit => {
                        let canEvolve = false;
                        
                        // æ£€æŸ¥æ˜¯å¦å¯è¿›åŒ–
                        if (['Rare', 'Epic', 'Legendary', 'Mythic'].includes(unit.rarity)) {
                            canEvolve = true;
                        }
                        
                        if (!canEvolve) {
                            output += `<p>  - ${unit.name}: ä¸å¯è¿›åŒ– (${unit.rarity})</p>`;
                            return false;
                        }
                        
                        // ç¨€æœ‰åº¦åŒ¹é…
                        if (testCase.rarity && unit.rarity !== testCase.rarity) {
                            output += `<p>  - ${unit.name}: ç¨€æœ‰åº¦ä¸åŒ¹é… (${unit.rarity} !== ${testCase.rarity})</p>`;
                            return false;
                        }
                        
                        // å…ƒç´ åŒ¹é…
                        if (testCase.element && unit.element !== testCase.element) {
                            output += `<p>  - ${unit.name}: å…ƒç´ ä¸åŒ¹é… (${unit.element} !== ${testCase.element})</p>`;
                            return false;
                        }
                        
                        output += `<p>  - ${unit.name}: âœ… é€šè¿‡æ‰€æœ‰ç­›é€‰æ¡ä»¶</p>`;
                        return true;
                    });
                    
                    output += `<p>ç»“æœ: ${filteredUnits.length} ä¸ªå•ä½</p><hr>`;
                });
                
                output += '<p class="success">âœ… ç­›é€‰å™¨æµ‹è¯•å®Œæˆ</p>';
                
            } catch (error) {
                output += `<p class="error">âŒ ç­›é€‰å™¨æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
            
            result.innerHTML = output;
        };

        // è¯Šæ–­é—®é¢˜
        window.diagnoseIssues = function() {
            const result = document.getElementById('diagnosisResult');
            let output = '';
            
            try {
                output += '<h4>ğŸ› é—®é¢˜è¯Šæ–­:</h4>';
                
                // æ£€æŸ¥å¯èƒ½çš„é—®é¢˜
                const issues = [];
                
                // é—®é¢˜1: æ•°æ®ä¸åŒ¹é…
                const unitsWithEvolution = mockUnitsData.filter(u => mockEvolutionData[u.id]);
                if (unitsWithEvolution.length === 0) {
                    issues.push("æ•°æ®ä¸åŒ¹é…: unitsData å’Œ evolutionData ä¸­çš„å•ä½IDä¸ä¸€è‡´");
                }
                
                // é—®é¢˜2: ç­›é€‰é€»è¾‘
                const evolvableByRarity = mockUnitsData.filter(u => ['Rare', 'Epic', 'Legendary', 'Mythic'].includes(u.rarity));
                if (evolvableByRarity.length === 0) {
                    issues.push("ç­›é€‰é€»è¾‘é—®é¢˜: æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆç¨€æœ‰åº¦æ¡ä»¶çš„å•ä½");
                }
                
                // é—®é¢˜3: æ•°æ®ä¼ é€’
                if (mockUnitsData.length === 0) {
                    issues.push("æ•°æ®ä¼ é€’é—®é¢˜: unitsData ä¸ºç©º");
                }
                
                // é—®é¢˜4: ç­›é€‰å™¨ç»‘å®š
                const hasFilters = true; // æ¨¡æ‹Ÿæ£€æŸ¥
                if (!hasFilters) {
                    issues.push("ç­›é€‰å™¨ç»‘å®šé—®é¢˜: ç­›é€‰å™¨äº‹ä»¶æœªæ­£ç¡®ç»‘å®š");
                }
                
                if (issues.length === 0) {
                    output += '<p class="success">âœ… æœªå‘ç°æ˜æ˜¾é—®é¢˜</p>';
                } else {
                    output += '<p class="warning">âš ï¸ å‘ç°ä»¥ä¸‹é—®é¢˜:</p>';
                    output += '<ul>';
                    issues.forEach(issue => {
                        output += `<li>${issue}</li>`;
                    });
                    output += '</ul>';
                }
                
                // å»ºè®®è§£å†³æ–¹æ¡ˆ
                output += '<h4>ğŸ’¡ å»ºè®®è§£å†³æ–¹æ¡ˆ:</h4>';
                output += '<ol>';
                output += '<li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯</li>';
                output += '<li>ç¡®è®¤æ•°æ®æ–‡ä»¶æ­£ç¡®åŠ è½½</li>';
                output += '<li>éªŒè¯ç­›é€‰å™¨HTMLå…ƒç´ å­˜åœ¨</li>';
                output += '<li>æ£€æŸ¥äº‹ä»¶ç»‘å®šæ˜¯å¦æ­£ç¡®</li>';
                output += '<li>ç¡®è®¤æ•°æ®æ ¼å¼ä¸€è‡´</li>';
                output += '</ol>';
                
                output += '<p class="success">âœ… é—®é¢˜è¯Šæ–­å®Œæˆ</p>';
                
            } catch (error) {
                output += `<p class="error">âŒ é—®é¢˜è¯Šæ–­å¤±è´¥: ${error.message}</p>`;
            }
            
            result.innerHTML = output;
        };

        console.log('ğŸš€ Evolution Guide æ•°æ®æµè°ƒè¯•é¡µé¢å·²åŠ è½½');
        console.log('ğŸ“Š æ¨¡æ‹Ÿæ•°æ®:', { mockUnitsData, mockEvolutionData });
    </script>
</body>
</html>
