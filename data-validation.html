<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Data Validation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .validation-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { color: #28a745; }
        .fail { color: #dc3545; }
        .warning { color: #ffc107; }
        .unit-list { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .unit-item { margin: 5px 0; padding: 5px; background: white; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Evolution Data Validation Report</h1>
        
        <div id="validationResults"></div>
    </div>

    <script type="module">
        import { EVOLUTION_UNITS, evolutionUtils } from './js/config/evolutionUnits.js';
        import { RARITIES, ELEMENTS, dataUtils } from './js/config/constants.js';

        const resultsDiv = document.getElementById('validationResults');

        function addSection(title, content, status = 'info') {
            const section = document.createElement('div');
            section.className = `validation-section ${status}`;
            section.innerHTML = `<h2>${title}</h2>${content}`;
            resultsDiv.appendChild(section);
        }

        function addUnitList(title, units) {
            let content = `<h3>${title}</h3><div class="unit-list">`;
            units.forEach(unit => {
                content += `<div class="unit-item">
                    <strong>${unit.name}</strong> (${unit.rarity}, ${unit.element}) â†’ ${unit.evolutionName}
                </div>`;
            });
            content += '</div>';
            return content;
        }

        // 1. åŸºæœ¬æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
        console.log('ğŸ” å¼€å§‹æ•°æ®å®Œæ•´æ€§éªŒè¯...');
        
        const totalUnits = EVOLUTION_UNITS.length;
        const validUnits = EVOLUTION_UNITS.filter(unit => 
            unit.id && unit.name && unit.rarity && unit.element && 
            typeof unit.canEvolve === 'boolean' && unit.evolutionName && unit.obtainMethod
        );

        addSection(
            'ğŸ“Š åŸºæœ¬æ•°æ®å®Œæ•´æ€§',
            `<p><strong>æ€»å•ä½æ•°:</strong> ${totalUnits}</p>
             <p><strong>æœ‰æ•ˆå•ä½æ•°:</strong> ${validUnits.length}</p>
             <p><strong>æ•°æ®å®Œæ•´æ€§:</strong> <span class="${validUnits.length === totalUnits ? 'pass' : 'fail'}">${validUnits.length === totalUnits ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</span></p>`,
            validUnits.length === totalUnits ? 'pass' : 'fail'
        );

        // 2. ç¨€æœ‰åº¦åˆ†å¸ƒæ£€æŸ¥
        const rarityDistribution = {};
        EVOLUTION_UNITS.forEach(unit => {
            rarityDistribution[unit.rarity] = (rarityDistribution[unit.rarity] || 0) + 1;
        });

        const canEvolveRarities = ['Vanguard', 'Secret', 'Exclusive', 'Mythic'];
        const hasAllRarities = canEvolveRarities.every(rarity => rarityDistribution[rarity] > 0);

        let rarityContent = '<h3>ç¨€æœ‰åº¦åˆ†å¸ƒ:</h3>';
        canEvolveRarities.forEach(rarity => {
            const count = rarityDistribution[rarity] || 0;
            const units = EVOLUTION_UNITS.filter(unit => unit.rarity === rarity);
            rarityContent += `<p><strong>${rarity}:</strong> ${count} ä¸ªå•ä½</p>`;
            if (count > 0) {
                rarityContent += addUnitList(`${rarity} å•ä½åˆ—è¡¨`, units);
            }
        });

        addSection(
            'ğŸ¯ ç¨€æœ‰åº¦åˆ†å¸ƒæ£€æŸ¥',
            rarityContent,
            hasAllRarities ? 'pass' : 'fail'
        );

        // 3. å…ƒç´ åˆ†å¸ƒæ£€æŸ¥
        const elementDistribution = {};
        EVOLUTION_UNITS.forEach(unit => {
            elementDistribution[unit.element] = (elementDistribution[unit.element] || 0) + 1;
        });

        let elementContent = '<h3>å…ƒç´ åˆ†å¸ƒ:</h3>';
        Object.keys(elementDistribution).forEach(element => {
            const count = elementDistribution[element];
            const units = EVOLUTION_UNITS.filter(unit => unit.element === element);
            elementContent += `<p><strong>${element}:</strong> ${count} ä¸ªå•ä½</p>`;
            if (count > 0) {
                elementContent += addUnitList(`${element} å•ä½åˆ—è¡¨`, units);
            }
        });

        addSection(
            'âš¡ å…ƒç´ åˆ†å¸ƒæ£€æŸ¥',
            elementContent,
            'info'
        );

        // 4. ç‰¹æ®ŠéªŒè¯ï¼šVanguard + Unknown ç»„åˆ
        const songJinwuUnit = EVOLUTION_UNITS.find(unit => 
            unit.id === 'song_jinwu_igros' && 
            unit.rarity === 'Vanguard' && 
            unit.element === 'Unknown'
        );

        const songJinwuContent = songJinwuUnit ? 
            `<p class="pass">âœ… æ‰¾åˆ° Song Jinwu and Igros (Vanguard + Unknown)</p>
             <div class="unit-item">
                 <strong>${songJinwuUnit.name}</strong> (${songJinwuUnit.rarity}, ${songJinwuUnit.element}) â†’ ${songJinwuUnit.evolutionName}
             </div>` :
            `<p class="fail">âŒ æœªæ‰¾åˆ° Song Jinwu and Igros (Vanguard + Unknown)</p>`;

        addSection(
            'ğŸ¯ ç‰¹æ®ŠéªŒè¯ï¼šVanguard + Unknown ç»„åˆ',
            songJinwuContent,
            songJinwuUnit ? 'pass' : 'fail'
        );

        // 5. å¯è¿›åŒ–æ€§æ£€æŸ¥
        const canEvolveUnits = EVOLUTION_UNITS.filter(unit => unit.canEvolve === true);
        const cannotEvolveUnits = EVOLUTION_UNITS.filter(unit => unit.canEvolve !== true);

        addSection(
            'ğŸ”„ å¯è¿›åŒ–æ€§æ£€æŸ¥',
            `<p><strong>å¯è¿›åŒ–å•ä½:</strong> ${canEvolveUnits.length}</p>
             <p><strong>ä¸å¯è¿›åŒ–å•ä½:</strong> ${cannotEvolveUnits.length}</p>
             <p><strong>å¯è¿›åŒ–æ€§:</strong> <span class="${canEvolveUnits.length === totalUnits ? 'pass' : 'warning'}">${canEvolveUnits.length === totalUnits ? 'âœ… å…¨éƒ¨å¯è¿›åŒ–' : 'âš ï¸ éƒ¨åˆ†å•ä½ä¸å¯è¿›åŒ–'}</span></p>`,
            canEvolveUnits.length === totalUnits ? 'pass' : 'warning'
        );

        // 6. æ•°æ®å­—æ®µå®Œæ•´æ€§
        const requiredFields = ['id', 'name', 'rarity', 'element', 'canEvolve', 'evolutionName', 'obtainMethod'];
        const missingFields = [];

        EVOLUTION_UNITS.forEach(unit => {
            requiredFields.forEach(field => {
                if (!unit.hasOwnProperty(field) || unit[field] === null || unit[field] === undefined || unit[field] === '') {
                    missingFields.push(`${unit.name || unit.id}: ç¼ºå°‘ ${field}`);
                }
            });
        });

        addSection(
            'ğŸ“‹ æ•°æ®å­—æ®µå®Œæ•´æ€§',
            missingFields.length === 0 ? 
                '<p class="pass">âœ… æ‰€æœ‰å¿…éœ€å­—æ®µéƒ½å·²å®Œæ•´</p>' :
                `<p class="fail">âŒ å‘ç°ç¼ºå¤±å­—æ®µ:</p><ul>${missingFields.map(field => `<li>${field}</li>`).join('')}</ul>`,
            missingFields.length === 0 ? 'pass' : 'fail'
        );

        // 7. æœ€ç»ˆæ€»ç»“
        const allTestsPassed = validUnits.length === totalUnits && 
                              hasAllRarities && 
                              songJinwuUnit && 
                              canEvolveUnits.length === totalUnits && 
                              missingFields.length === 0;

        addSection(
            'ğŸ“ˆ éªŒè¯æ€»ç»“',
            `<h3>éªŒè¯ç»“æœ: <span class="${allTestsPassed ? 'pass' : 'fail'}">${allTestsPassed ? 'âœ… å…¨éƒ¨é€šè¿‡' : 'âŒ å­˜åœ¨é—®é¢˜'}</span></h3>
             <ul>
                 <li>æ•°æ®å®Œæ•´æ€§: ${validUnits.length === totalUnits ? 'âœ…' : 'âŒ'}</li>
                 <li>ç¨€æœ‰åº¦è¦†ç›–: ${hasAllRarities ? 'âœ…' : 'âŒ'}</li>
                 <li>Vanguard+Unknownç»„åˆ: ${songJinwuUnit ? 'âœ…' : 'âŒ'}</li>
                 <li>å¯è¿›åŒ–æ€§: ${canEvolveUnits.length === totalUnits ? 'âœ…' : 'âš ï¸'}</li>
                 <li>å­—æ®µå®Œæ•´æ€§: ${missingFields.length === 0 ? 'âœ…' : 'âŒ'}</li>
             </ul>`,
            allTestsPassed ? 'pass' : 'fail'
        );

        console.log('âœ… æ•°æ®éªŒè¯å®Œæˆï¼');
    </script>
</body>
</html> 