<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Debug - Anime Vanguards Wiki</title>
    <link rel="stylesheet" href="css/evolution-display.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .debug-info {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #ef4444;
        }
        
        .debug-success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #22c55e;
        }
        
        .debug-log {
            background: rgba(51, 65, 85, 0.8);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Evolution Debug Page</h1>
            <p>Testing unit selection and callback functionality</p>
        </header>
        
        <div class="debug-info">
            <h3>üîç Debug Information</h3>
            <p>This page is designed to test the unit selection functionality and identify why the right panels are not updating.</p>
        </div>
        
        <div class="main-content">
            <div class="left-column">
                <div class="unit-selection-section">
                    <h2>Unit Selection</h2>
                    
                    <!-- Filter Section -->
                    <div class="filter-section">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="rarityFilter">Rarity:</label>
                                <select id="rarityFilter">
                                    <option value="">All Rarity</option>
                                    <option value="Mythic">Mythic</option>
                                    <option value="Secret">Secret</option>
                                    <option value="Legendary">Legendary</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="elementFilter">Element:</label>
                                <select id="elementFilter">
                                    <option value="">All Element</option>
                                    <option value="Fire">Fire</option>
                                    <option value="Dark">Dark</option>
                                    <option value="Physical">Physical</option>
                                    <option value="Energy">Energy</option>
                                </select>
                            </div>
                            
                            <div class="search-group">
                                <label for="unitSearch">Search:</label>
                                <input type="text" id="unitSearch" placeholder="Search units...">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Unit Select -->
                    <div class="unit-select-section">
                        <label for="unitSelect">Select Unit:</label>
                        <select id="unitSelect">
                            <option value="">Select Unit...</option>
                        </select>
                    </div>
                    
                    <!-- Unit Card Placeholder -->
                    <div id="unitPlaceholder" class="unit-placeholder">
                        <p>No unit selected</p>
                    </div>
                </div>
            </div>
            
            <div class="right-column">
                <!-- Evolution Requirements -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-search"></i>
                        <h3>Evolution Requirements</h3>
                    </div>
                    <div id="evolutionRequirementsContainer">
                        <p>No Unit Selected. Please select a unit from the list above to view its evolution requirements and materials.</p>
                    </div>
                </div>

                <!-- Cost Summary -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-calculator"></i>
                        <h3>Cost Summary</h3>
                    </div>
                    <div id="costSummaryContainer">
                        <p>No Unit Selected. Select a unit to view its evolution cost summary.</p>
                    </div>
                </div>

                <!-- Farming Guide -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-map"></i>
                        <h3>Farming Guide</h3>
                    </div>
                    <div id="farmingGuideContainer">
                        <p>No Unit Selected. Select a unit to view its farming guide.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="debug-section">
            <h3>üîß Debug Console</h3>
            <div id="debugLog" class="debug-log">
                <div>Debug log will appear here...</div>
            </div>
            
            <div class="debug-controls">
                <button onclick="testUnitSelection()">Test Unit Selection</button>
                <button onclick="clearDebugLog()">Clear Log</button>
                <button onclick="checkCallbacks()">Check Callbacks</button>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { UnitSelector } from './js/components/UnitSelector.js';
        import { REAL_EVOLUTION_DATA } from './js/config/realEvolutionData.js';
        import { unitsData } from './js/config/units.js';
        
        // Debug logging function
        window.debugLog = function(message, type = 'info') {
            const logContainer = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.style.color = type === 'error' ? '#ef4444' : type === 'success' ? '#22c55e' : '#f1f5f9';
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        };
        
        // Test functions
        window.testUnitSelection = function() {
            debugLog('üß™ Testing unit selection...', 'info');
            
            // Simulate selecting a unit
            const unitSelect = document.getElementById('unitSelect');
            if (unitSelect.options.length > 1) {
                unitSelect.value = unitSelect.options[1].value;
                unitSelect.dispatchEvent(new Event('change'));
                debugLog('‚úÖ Unit selection event triggered', 'success');
            } else {
                debugLog('‚ùå No units available for testing', 'error');
            }
        };
        
        window.clearDebugLog = function() {
            document.getElementById('debugLog').innerHTML = '<div>Debug log cleared...</div>';
        };
        
        window.checkCallbacks = function() {
            debugLog('üîç Checking callback functions...', 'info');
            
            if (window.unitSelector && window.unitSelector.options && window.unitSelector.options.onUnitSelect) {
                debugLog('‚úÖ onUnitSelect callback is set', 'success');
            } else {
                debugLog('‚ùå onUnitSelect callback is NOT set', 'error');
            }
        };
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ Initializing debug page...', 'info');
            
            // Create a simple unit selector for testing
            const unitSelector = new UnitSelector('unitSelectorContainer', {
                onUnitSelect: function(unit) {
                    debugLog(`üìû onUnitSelect callback triggered with unit: ${unit.name}`, 'success');
                    
                    // Test the evolution data lookup
                    const unitId = unit.id.toLowerCase().replace(/\s+/g, '');
                    debugLog(`üîç Looking up evolution data for ID: ${unitId}`, 'info');
                    
                    const evolutionData = REAL_EVOLUTION_DATA[unitId];
                    if (evolutionData) {
                        debugLog(`‚úÖ Found evolution data: ${evolutionData.evolutionName}`, 'success');
                        
                        // Update the panels
                        updateEvolutionRequirements(evolutionData);
                        updateCostSummary(evolutionData);
                        updateFarmingGuide(evolutionData);
                    } else {
                        debugLog(`‚ùå No evolution data found for ${unitId}`, 'error');
                        showNoEvolutionData(unit);
                    }
                },
                showFilters: true,
                showSearch: true
            });
            
            // Store reference for debugging
            window.unitSelector = unitSelector;
            
            // Filter evolvable units
            const evolvableUnits = Object.values(unitsData).filter(unit => 
                unit.rarity === 'Mythic' || unit.rarity === 'Secret' || unit.rarity === 'Vanguard'
            );
            
            debugLog(`üìä Found ${evolvableUnits.length} evolvable units`, 'info');
            
            // Set units data
            unitSelector.setUnits(evolvableUnits, {
                Fire: 'fas fa-fire',
                Dark: 'fas fa-moon',
                Physical: 'fas fa-fist-raised',
                Energy: 'fas fa-bolt'
            });
            
            debugLog('‚úÖ Debug page initialized successfully', 'success');
        });
        
        // Panel update functions
        function updateEvolutionRequirements(evolutionInfo) {
            debugLog('üìã Updating evolution requirements...', 'info');
            
            const container = document.getElementById('evolutionRequirementsContainer');
            if (container && evolutionInfo) {
                container.innerHTML = `
                    <div class="evolution-requirements">
                        <h4>Evolution Path</h4>
                        <p><strong>${evolutionInfo.name}</strong> ‚Üí <strong>${evolutionInfo.evolutionName}</strong></p>
                        <h4>Requirements</h4>
                        <p><strong>Cost:</strong> ${evolutionInfo.requirements.cost} Gold</p>
                        <p><strong>Materials:</strong> ${evolutionInfo.requirements.materials.length} types</p>
                    </div>
                `;
                debugLog('‚úÖ Evolution requirements updated', 'success');
            }
        }
        
        function updateCostSummary(evolutionInfo) {
            debugLog('üí∞ Updating cost summary...', 'info');
            
            const container = document.getElementById('costSummaryContainer');
            if (container && evolutionInfo) {
                container.innerHTML = `
                    <div class="cost-summary">
                        <h4>Cost Breakdown</h4>
                        <p><strong>Evolution Fee:</strong> ${evolutionInfo.requirements.cost} Gold</p>
                        <p><strong>Materials:</strong> ${evolutionInfo.requirements.materials.length} types</p>
                        <p><strong>Total Estimated:</strong> ${evolutionInfo.requirements.cost + 1000} Gold</p>
                    </div>
                `;
                debugLog('‚úÖ Cost summary updated', 'success');
            }
        }
        
        function updateFarmingGuide(evolutionInfo) {
            debugLog('üåæ Updating farming guide...', 'info');
            
            const container = document.getElementById('farmingGuideContainer');
            if (container && evolutionInfo) {
                container.innerHTML = `
                    <div class="farming-guide">
                        <h4>Farming Recommendations</h4>
                        <p><strong>Difficulty:</strong> High</p>
                        <p><strong>Estimated Time:</strong> 2-3 weeks</p>
                        <p><strong>Best Locations:</strong> Red Key Quest, Martial Island</p>
                    </div>
                `;
                debugLog('‚úÖ Farming guide updated', 'success');
            }
        }
        
        function showNoEvolutionData(unit) {
            debugLog('‚ö†Ô∏è Showing no evolution data message...', 'info');
            
            const containers = [
                'evolutionRequirementsContainer',
                'costSummaryContainer', 
                'farmingGuideContainer'
            ];
            
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <div class="no-evolution-data">
                            <p><strong>No Evolution Data</strong></p>
                            <p>Unit "${unit.name}" does not have evolution data available.</p>
                        </div>
                    `;
                }
            });
            
            debugLog('‚úÖ No evolution data message displayed', 'success');
        }
    </script>
</body>
</html>
