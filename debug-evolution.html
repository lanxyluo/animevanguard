<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Guide è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .debug-output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .success {
            color: #28a745;
            font-weight: bold;
        }
        
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
        
        .unit-display {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        
        .unit-name {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }
        
        .unit-details {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Evolution Guide è°ƒè¯•é¡µé¢</h1>
        
        <div class="debug-section">
            <h3>ğŸ¯ è°ƒè¯•æ§åˆ¶</h3>
            <button class="btn" onclick="testDataFlow()">ğŸ§ª æµ‹è¯•æ•°æ®æµ</button>
            <button class="btn" onclick="testUnitSelector()">ğŸ” æµ‹è¯•UnitSelector</button>
            <button class="btn" onclick="testFilters()">ğŸ›ï¸ æµ‹è¯•ç­›é€‰å™¨</button>
            <button class="btn" onclick="clearDebug()">ğŸ—‘ï¸ æ¸…é™¤è°ƒè¯•ä¿¡æ¯</button>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ“Š æ•°æ®çŠ¶æ€</h3>
            <div id="dataStatus" class="debug-output">
                ç‚¹å‡»æµ‹è¯•æŒ‰é’®å¼€å§‹è°ƒè¯•...
            </div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ” æ§åˆ¶å°æ—¥å¿—</h3>
            <div id="consoleLog" class="debug-output">
                æ§åˆ¶å°æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>
        
        <div class="debug-section">
            <h3>ğŸ“‹ å•ä½åˆ—è¡¨</h3>
            <div id="unitsList" class="debug-output">
                å•ä½åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿæ•°æ® - ä¸evolution.jsä¸­ä½¿ç”¨çš„ç›¸åŒ
        const mockUnitsData = [
            {
                id: "goku_ultra_instinct",
                name: "Goku (Ultra Instinct)",
                rarity: "Mythic",
                element: "Energy",
                evolution: "Ultra Instinct",
                obtainment: "Dragon Ball Banner (0.1% drop rate)"
            },
            {
                id: "saitama",
                name: "Saitama",
                rarity: "Mythic",
                element: "Physical",
                evolution: "One Punch Man",
                obtainment: "One Punch Man Banner (0.1% drop rate)"
            },
            {
                id: "goku_base",
                name: "Goku",
                rarity: "Legendary",
                element: "Energy",
                evolution: "Base Form",
                obtainment: "Dragon Ball Banner (2% drop rate)"
            },
            {
                id: "naruto_base",
                name: "Naruto",
                rarity: "Legendary",
                element: "Wind",
                evolution: "Six Paths Sage Mode",
                obtainment: "Naruto Banner (2% drop rate)"
            },
            {
                id: "tanjiro",
                name: "Tanjiro",
                rarity: "Epic",
                element: "Water",
                evolution: "Sun Breathing",
                obtainment: "Demon Slayer Banner (5% drop rate)"
            },
            {
                id: "ichigo_base",
                name: "Ichigo",
                rarity: "Epic",
                element: "Soul",
                evolution: "Bankai",
                obtainment: "Bleach Banner (5% drop rate)"
            }
        ];

        const mockEvolutionData = {
            "goku": {
                unitId: "goku",
                evolutions: [
                    { tier: 1, name: "Goku", requirements: { level: 1, materials: [], cost: 1200 } },
                    { tier: 2, name: "Super Saiyan Goku", requirements: { level: 40, materials: ["Saiyan Blood x4"], cost: 2500 } },
                    { tier: 3, name: "Super Saiyan Blue Goku", requirements: { level: 60, materials: ["Divine Ki x3"], cost: 4500 } }
                ]
            },
            "tanjiro": {
                unitId: "tanjiro",
                evolutions: [
                    { tier: 1, name: "Tanjiro", requirements: { level: 1, materials: [], cost: 800 } },
                    { tier: 2, name: "Tanjiro (Water Breathing Master)", requirements: { level: 35, materials: ["Water Essence x3"], cost: 1500 } },
                    { tier: 3, name: "Tanjiro (Sun Breathing)", requirements: { level: 55, materials: ["Sun Stone x2"], cost: 2200 } }
                ]
            }
        };

        // æ¨¡æ‹ŸRARITIESå’ŒELEMENTSå¸¸é‡
        const RARITIES = [
            { value: "Common", label: "Common", canEvolve: false },
            { value: "Uncommon", label: "Uncommon", canEvolve: false },
            { value: "Rare", label: "Rare", canEvolve: true },
            { value: "Epic", label: "Epic", canEvolve: true },
            { value: "Legendary", label: "Legendary", canEvolve: true },
            { value: "Mythic", label: "Mythic", canEvolve: true }
        ];

        const ELEMENTS = [
            { value: "Fire", label: "Fire" },
            { value: "Water", label: "Water" },
            { value: "Wind", label: "Wind" },
            { value: "Lightning", label: "Lightning" },
            { value: "Dark", label: "Dark" },
            { value: "Light", label: "Light" },
            { value: "Physical", label: "Physical" },
            { value: "Energy", label: "Energy" },
            { value: "Soul", label: "Soul" }
        ];

        // æµ‹è¯•æ•°æ®æµ
        window.testDataFlow = function() {
            console.log('ğŸ§ª å¼€å§‹æµ‹è¯•æ•°æ®æµ...');
            
            const dataStatus = document.getElementById('dataStatus');
            let output = 'ğŸ” æ•°æ®æµæµ‹è¯•ç»“æœ:\n\n';
            
            // 1. æ£€æŸ¥åŸºç¡€æ•°æ®
            output += `ğŸ“Š åŸºç¡€æ•°æ®:\n`;
            output += `  - å•ä½æ•°æ®æ•°é‡: ${mockUnitsData.length}\n`;
            output += `  - è¿›åŒ–æ•°æ®æ•°é‡: ${Object.keys(mockEvolutionData).length}\n`;
            output += `  - ç¨€æœ‰åº¦ç±»å‹: ${RARITIES.length}\n`;
            output += `  - å…ƒç´ ç±»å‹: ${ELEMENTS.length}\n\n`;
            
            // 2. æ£€æŸ¥å¯è¿›åŒ–å•ä½
            const evolvableUnits = mockUnitsData.filter(unit => {
                const possibleIds = [
                    unit.id,
                    unit.id.replace(/_base$/, ''),
                    unit.id.replace(/_evolved$/, ''),
                    unit.name.toLowerCase().replace(/\s+/g, ''),
                    unit.name.toLowerCase().replace(/\s+/g, '').replace(/\([^)]*\)/g, '')
                ];
                
                const hasEvolutionData = possibleIds.some(id => mockEvolutionData[id] !== undefined);
                const canEvolveByRarity = ['Rare', 'Epic', 'Legendary', 'Mythic'].includes(unit.rarity);
                
                return hasEvolutionData || canEvolveByRarity;
            });
            
            output += `ğŸ”¬ å¯è¿›åŒ–å•ä½åˆ†æ:\n`;
            output += `  - å¯è¿›åŒ–å•ä½æ€»æ•°: ${evolvableUnits.length}\n`;
            output += `  - æŒ‰ç¨€æœ‰åº¦åˆ†å¸ƒ:\n`;
            
            const rarityDistribution = {};
            evolvableUnits.forEach(unit => {
                rarityDistribution[unit.rarity] = (rarityDistribution[unit.rarity] || 0) + 1;
            });
            
            Object.entries(rarityDistribution).forEach(([rarity, count]) => {
                output += `    * ${rarity}: ${count}\n`;
            });
            
            output += `\n  - æŒ‰å…ƒç´ åˆ†å¸ƒ:\n`;
            const elementDistribution = {};
            evolvableUnits.forEach(unit => {
                elementDistribution[unit.element] = (elementDistribution[unit.element] || 0) + 1;
            });
            
            Object.entries(elementDistribution).forEach(([element, count]) => {
                output += `    * ${element}: ${count}\n`;
            });
            
            dataStatus.textContent = output;
            
            // æ›´æ–°å•ä½åˆ—è¡¨æ˜¾ç¤º
            updateUnitsList(evolvableUnits);
            
            console.log('âœ… æ•°æ®æµæµ‹è¯•å®Œæˆ');
        };

        // æµ‹è¯•UnitSelector
        window.testUnitSelector = function() {
            console.log('ğŸ” å¼€å§‹æµ‹è¯•UnitSelector...');
            
            const consoleLog = document.getElementById('consoleLog');
            consoleLog.textContent = 'ğŸ” UnitSelectoræµ‹è¯•:\n\n';
            
            // æ¨¡æ‹ŸUnitSelectorçš„è¡Œä¸º
            const testUnits = mockUnitsData.filter(u => ['Rare', 'Epic', 'Legendary', 'Mythic'].includes(u.rarity));
            
            consoleLog.textContent += `ğŸ“Š æµ‹è¯•å•ä½æ•°æ®:\n`;
            consoleLog.textContent += `  - æ€»å•ä½æ•°: ${mockUnitsData.length}\n`;
            consoleLog.textContent += `  - å¯è¿›åŒ–å•ä½æ•°: ${testUnits.length}\n`;
            consoleLog.textContent += `  - ç¨€æœ‰åº¦ç­›é€‰å™¨é€‰é¡¹: ${RARITIES.filter(r => r.canEvolve).length}\n`;
            consoleLog.textContent += `  - å…ƒç´ ç­›é€‰å™¨é€‰é¡¹: ${ELEMENTS.length}\n\n`;
            
            consoleLog.textContent += `ğŸ¯ ç­›é€‰å™¨æµ‹è¯•:\n`;
            
            // æµ‹è¯•ç¨€æœ‰åº¦ç­›é€‰
            RARITIES.filter(r => r.canEvolve).forEach(rarity => {
                const filtered = testUnits.filter(u => u.rarity === rarity.value);
                consoleLog.textContent += `  - ${rarity.label}: ${filtered.length} å•ä½\n`;
            });
            
            consoleLog.textContent += `\n`;
            
            // æµ‹è¯•å…ƒç´ ç­›é€‰
            ELEMENTS.forEach(element => {
                const filtered = testUnits.filter(u => u.element === element.value);
                consoleLog.textContent += `  - ${element.label}: ${filtered.length} å•ä½\n`;
            });
            
            console.log('âœ… UnitSelectoræµ‹è¯•å®Œæˆ');
        };

        // æµ‹è¯•ç­›é€‰å™¨
        window.testFilters = function() {
            console.log('ğŸ›ï¸ å¼€å§‹æµ‹è¯•ç­›é€‰å™¨...');
            
            const consoleLog = document.getElementById('consoleLog');
            consoleLog.textContent += `\nğŸ›ï¸ ç­›é€‰å™¨ç»„åˆæµ‹è¯•:\n\n`;
            
            const testUnits = mockUnitsData.filter(u => ['Rare', 'Epic', 'Legendary', 'Mythic'].includes(u.rarity));
            
            // æµ‹è¯•ç¨€æœ‰åº¦ + å…ƒç´ ç»„åˆ
            const testCases = [
                { rarity: 'Mythic', element: 'Energy' },
                { rarity: 'Mythic', element: 'Physical' },
                { rarity: 'Legendary', element: 'Wind' },
                { rarity: 'Epic', element: 'Water' }
            ];
            
            testCases.forEach(testCase => {
                const filtered = testUnits.filter(u => 
                    u.rarity === testCase.rarity && u.element === testCase.element
                );
                
                consoleLog.textContent += `ğŸ” ${testCase.rarity} + ${testCase.element}: ${filtered.length} å•ä½\n`;
                if (filtered.length > 0) {
                    filtered.forEach(unit => {
                        consoleLog.textContent += `    * ${unit.name}\n`;
                    });
                }
                consoleLog.textContent += `\n`;
            });
            
            console.log('âœ… ç­›é€‰å™¨æµ‹è¯•å®Œæˆ');
        };

        // æ›´æ–°å•ä½åˆ—è¡¨æ˜¾ç¤º
        function updateUnitsList(units) {
            const unitsList = document.getElementById('unitsList');
            
            if (units.length === 0) {
                unitsList.textContent = 'âŒ æ²¡æœ‰æ‰¾åˆ°å¯è¿›åŒ–å•ä½';
                return;
            }
            
            let output = `ğŸ“‹ å¯è¿›åŒ–å•ä½åˆ—è¡¨ (${units.length} ä¸ª):\n\n`;
            
            units.forEach((unit, index) => {
                output += `${index + 1}. ${unit.name}\n`;
                output += `   - ID: ${unit.id}\n`;
                output += `   - ç¨€æœ‰åº¦: ${unit.rarity}\n`;
                output += `   - å…ƒç´ : ${unit.element}\n`;
                output += `   - è¿›åŒ–: ${unit.evolution}\n`;
                output += `\n`;
            });
            
            unitsList.textContent = output;
        }

        // æ¸…é™¤è°ƒè¯•ä¿¡æ¯
        window.clearDebug = function() {
            document.getElementById('dataStatus').textContent = 'ç‚¹å‡»æµ‹è¯•æŒ‰é’®å¼€å§‹è°ƒè¯•...';
            document.getElementById('consoleLog').textContent = 'æ§åˆ¶å°æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            document.getElementById('unitsList').textContent = 'å•ä½åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            console.log('ğŸ—‘ï¸ è°ƒè¯•ä¿¡æ¯å·²æ¸…é™¤');
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Evolution Guide è°ƒè¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“Š æ¨¡æ‹Ÿæ•°æ®å·²å‡†å¤‡å°±ç»ª');
            console.log('ğŸ” å¯ä»¥å¼€å§‹æµ‹è¯•æ•°æ®æµå’Œç»„ä»¶åŠŸèƒ½');
        });
    </script>
</body>
</html>
