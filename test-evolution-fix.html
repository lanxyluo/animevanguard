<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Fix æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Evolution Fix æµ‹è¯•é¡µé¢</h1>
        
        <div class="test-section">
            <h3>ğŸ§ª æµ‹è¯•ä¿®å¤</h3>
            <button class="btn" onclick="testEvolutionFix()">æµ‹è¯•Evolutionä¿®å¤</button>
            <button class="btn" onclick="testComponentInit()">æµ‹è¯•ç»„ä»¶åˆå§‹åŒ–</button>
            <button class="btn" onclick="testDataFlow()">æµ‹è¯•æ•°æ®æµ</button>
            <button class="btn" onclick="clearOutput()">æ¸…é™¤è¾“å‡º</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testOutput" class="output">
                ç‚¹å‡»æµ‹è¯•æŒ‰é’®å¼€å§‹æµ‹è¯•...
            </div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹ŸevolutionData
        const mockEvolutionData = {
            "goku": {
                unitId: "goku",
                evolutions: [
                    { tier: 1, name: "Goku", requirements: { level: 1, materials: [], cost: 1200 } },
                    { tier: 2, name: "Super Saiyan Goku", requirements: { level: 40, materials: ["Saiyan Blood x4"], cost: 2500 } },
                    { tier: 3, name: "Super Saiyan Blue Goku", requirements: { level: 60, materials: ["Divine Ki x3"], cost: 4500 } }
                ]
            }
        };

        // æ¨¡æ‹ŸunitsData
        const mockUnitsData = [
            {
                id: "goku_base",
                name: "Goku",
                rarity: "Legendary",
                element: "Energy"
            }
        ];

        // æµ‹è¯•Evolutionä¿®å¤
        window.testEvolutionFix = function() {
            const output = document.getElementById('testOutput');
            output.innerHTML = 'ğŸ§ª å¼€å§‹æµ‹è¯•Evolutionä¿®å¤...\n\n';
            
            try {
                // 1. æµ‹è¯•æ•°æ®æŸ¥æ‰¾
                output.innerHTML += 'ğŸ“Š æµ‹è¯•æ•°æ®æŸ¥æ‰¾:\n';
                const unit = mockUnitsData[0];
                const unitId = unit.name.toLowerCase().replace(/\s+/g, '');
                const evolutionInfo = mockEvolutionData[unitId];
                
                output.innerHTML += `  - å•ä½: ${unit.name}\n`;
                output.innerHTML += `  - ç”Ÿæˆçš„ID: ${unitId}\n`;
                output.innerHTML += `  - æ‰¾åˆ°è¿›åŒ–æ•°æ®: ${!!evolutionInfo}\n`;
                output.innerHTML += `  - è¿›åŒ–å±‚æ•°: ${evolutionInfo ? evolutionInfo.evolutions.length : 0}\n\n`;
                
                // 2. æµ‹è¯•è¿›åŒ–ä¿¡æ¯å¤„ç†
                if (evolutionInfo) {
                    output.innerHTML += 'ğŸ”¬ è¿›åŒ–ä¿¡æ¯å¤„ç†:\n';
                    const processedInfo = {
                        ...unit,
                        unitId: unitId,
                        evolutionData: evolutionInfo,
                        evolutions: evolutionInfo.evolutions,
                        hasEvolutionData: true
                    };
                    
                    output.innerHTML += `  - å¤„ç†åçš„ä¿¡æ¯: ${JSON.stringify(processedInfo, null, 2)}\n\n`;
                }
                
                output.innerHTML += '<span class="success">âœ… Evolutionä¿®å¤æµ‹è¯•å®Œæˆ</span>\n';
                
            } catch (error) {
                output.innerHTML += `<span class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</span>\n`;
                console.error('Test failed:', error);
            }
        };

        // æµ‹è¯•ç»„ä»¶åˆå§‹åŒ–
        window.testComponentInit = function() {
            const output = document.getElementById('testOutput');
            output.innerHTML = 'ğŸ”§ å¼€å§‹æµ‹è¯•ç»„ä»¶åˆå§‹åŒ–...\n\n';
            
            try {
                // æ¨¡æ‹Ÿç»„ä»¶åˆå§‹åŒ–
                const components = {
                    unitSelector: { setUnits: () => console.log('UnitSelector initialized') },
                    costSummary: { render: () => '<div>Cost Summary</div>' },
                    materialsList: { render: () => '<div>Materials List</div>' },
                    farmingGuide: { render: () => '<div>Farming Guide</div>' },
                    evolutionRequirements: { render: () => '<div>Evolution Requirements</div>' }
                };
                
                output.innerHTML += 'ğŸ“¦ ç»„ä»¶çŠ¶æ€:\n';
                Object.entries(components).forEach(([name, component]) => {
                    output.innerHTML += `  - ${name}: ${component ? 'âœ… å·²åˆå§‹åŒ–' : 'âŒ æœªåˆå§‹åŒ–'}\n`;
                });
                
                output.innerHTML += '\nğŸ¯ æµ‹è¯•ç»„ä»¶æ–¹æ³•:\n';
                
                // æµ‹è¯•UnitSelector
                if (components.unitSelector) {
                    components.unitSelector.setUnits(mockUnitsData, {});
                    output.innerHTML += '  - UnitSelector.setUnits() è°ƒç”¨æˆåŠŸ\n';
                }
                
                // æµ‹è¯•EvolutionRequirements
                if (components.evolutionRequirements) {
                    const html = components.evolutionRequirements.render('goku');
                    output.innerHTML += `  - EvolutionRequirements.render() è¿”å›: ${html}\n`;
                }
                
                output.innerHTML += '\n<span class="success">âœ… ç»„ä»¶åˆå§‹åŒ–æµ‹è¯•å®Œæˆ</span>\n';
                
            } catch (error) {
                output.innerHTML += `<span class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</span>\n`;
                console.error('Test failed:', error);
            }
        };

        // æµ‹è¯•æ•°æ®æµ
        window.testDataFlow = function() {
            const output = document.getElementById('testOutput');
            output.innerHTML = 'ğŸ”„ å¼€å§‹æµ‹è¯•æ•°æ®æµ...\n\n';
            
            try {
                // æ¨¡æ‹Ÿå®Œæ•´çš„æ•°æ®æµ
                output.innerHTML += 'ğŸ“Š æ•°æ®æµæµ‹è¯•:\n';
                
                // 1. å•ä½é€‰æ‹©
                const selectedUnit = mockUnitsData[0];
                output.innerHTML += `  1. é€‰æ‹©å•ä½: ${selectedUnit.name}\n`;
                
                // 2. ç”Ÿæˆå•ä½ID
                const unitId = selectedUnit.name.toLowerCase().replace(/\s+/g, '');
                output.innerHTML += `  2. ç”Ÿæˆå•ä½ID: ${unitId}\n`;
                
                // 3. æŸ¥æ‰¾è¿›åŒ–æ•°æ®
                const evolutionInfo = mockEvolutionData[unitId];
                output.innerHTML += `  3. æŸ¥æ‰¾è¿›åŒ–æ•°æ®: ${evolutionInfo ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°'}\n`;
                
                // 4. å¤„ç†è¿›åŒ–ä¿¡æ¯
                if (evolutionInfo) {
                    const processedInfo = {
                        ...selectedUnit,
                        unitId: unitId,
                        evolutionData: evolutionInfo,
                        evolutions: evolutionInfo.evolutions,
                        hasEvolutionData: true
                    };
                    
                    output.innerHTML += `  4. å¤„ç†è¿›åŒ–ä¿¡æ¯: âœ… å®Œæˆ\n`;
                    output.innerHTML += `     - å•ä½ID: ${processedInfo.unitId}\n`;
                    output.innerHTML += `     - æœ‰è¿›åŒ–æ•°æ®: ${processedInfo.hasEvolutionData}\n`;
                    output.innerHTML += `     - è¿›åŒ–å±‚æ•°: ${processedInfo.evolutions.length}\n`;
                }
                
                // 5. æ¨¡æ‹Ÿæ˜¾ç¤ºæ›´æ–°
                output.innerHTML += `  5. æ›´æ–°æ˜¾ç¤º: âœ… æ¨¡æ‹Ÿå®Œæˆ\n`;
                
                output.innerHTML += '\n<span class="success">âœ… æ•°æ®æµæµ‹è¯•å®Œæˆ</span>\n';
                
            } catch (error) {
                output.innerHTML += `<span class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</span>\n`;
                console.error('Test failed:', error);
            }
        };

        // æ¸…é™¤è¾“å‡º
        window.clearOutput = function() {
            document.getElementById('testOutput').innerHTML = 'ç‚¹å‡»æµ‹è¯•æŒ‰é’®å¼€å§‹æµ‹è¯•...';
            console.log('ğŸ—‘ï¸ è¾“å‡ºå·²æ¸…é™¤');
        };

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Evolution Fix æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“Š æ¨¡æ‹Ÿæ•°æ®å·²å‡†å¤‡å°±ç»ª');
            console.log('ğŸ” å¯ä»¥å¼€å§‹æµ‹è¯•ä¿®å¤æ•ˆæœ');
        });
    </script>
</body>
</html>
