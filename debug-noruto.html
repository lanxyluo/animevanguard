<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noruto 进化数据调试</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(162, 155, 254, 0.3);
        }
        
        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .debug-section h3 {
            margin-top: 0;
            color: #4facfe;
            border-bottom: 2px solid #4facfe;
            padding-bottom: 10px;
        }
        
        .btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        
        .output {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196f3; }
        
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .data-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-card h4 {
            color: #00f2fe;
            margin-top: 0;
        }
        
        .material-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 3px solid #4facfe;
        }
        
        .evolution-step {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .evolution-step h5 {
            color: #4facfe;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 Noruto 进化数据调试页面</h1>
        
        <div class="debug-section">
            <h3>🧪 调试测试</h3>
            <button class="btn" onclick="testNorutoData()">测试Noruto数据</button>
            <button class="btn" onclick="testIdMatching()">测试ID匹配</button>
            <button class="btn" onclick="testEvolutionData()">测试进化数据</button>
            <button class="btn" onclick="clearOutput()">清除输出</button>
        </div>
        
        <div class="debug-section">
            <h3>📊 调试结果</h3>
            <div id="debugOutput" class="output">
                点击测试按钮开始调试...
            </div>
        </div>
        
        <div class="debug-section">
            <h3>🏗️ 模拟进化系统</h3>
            <div id="evolutionDisplay" class="data-grid">
                <div class="data-card">
                    <h4>Evolution Requirements</h4>
                    <div id="evolution-requirements">
                        <p>等待测试数据...</p>
                    </div>
                </div>
                
                <div class="data-card">
                    <h4>Cost Summary</h4>
                    <div id="cost-summary">
                        <p>等待测试数据...</p>
                    </div>
                </div>
                
                <div class="data-card">
                    <h4>Evolution Materials</h4>
                    <div id="evolution-materials">
                        <p>等待测试数据...</p>
                    </div>
                </div>
                
                <div class="data-card">
                    <h4>Farming Guide</h4>
                    <div id="farming-guide">
                        <p>等待测试数据...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // 模拟数据
        const mockEvolutionData = {
            "noruto": {
                unitId: "noruto",
                name: "Noruto",
                rarity: "Mythic",
                element: "Wind",
                evolutions: [
                    {
                        tier: 1,
                        name: "Noruto",
                        statMultiplier: 1.0,
                        requirements: {
                            level: 1,
                            cost: 0,
                            gems: 0,
                            materials: []
                        }
                    },
                    {
                        tier: 2,
                        name: "Noruto (Six Tails)",
                        statMultiplier: 1.5,
                        requirements: {
                            level: 50,
                            cost: 5000,
                            gems: 0,
                            materials: [
                                "Flame Heart x4",
                                "Hashira Spirit x1",
                                "Unyielding Will x1"
                            ]
                        }
                    },
                    {
                        tier: 3,
                        name: "Noruto (Nine Tails)",
                        statMultiplier: 2.0,
                        requirements: {
                            level: 100,
                            cost: 10000,
                            gems: 125,
                            materials: [
                                "Eternal Flame x3",
                                "Hashira Legacy x2",
                                "Father's Pride x1",
                                "Flame Pillar x5"
                            ]
                        }
                    }
                ]
            }
        };

        const mockUnitsData = [
            {
                id: "noruto_base",
                name: "Noruto",
                rarity: "Mythic",
                element: "Wind",
                canEvolve: true
            }
        ];

        // 模拟方法
        function generateUnitId(unitName) {
            let id = unitName.toLowerCase().replace(/\s+/g, '');
            id = id.replace(/\([^)]*\)/g, '');
            id = id.replace(/\s+/g, '');
            return id;
        }

        function lookupEvolutionData(unitId, unit) {
            console.log(`🔍 Looking up evolution data for: ${unit.name} (ID: ${unitId})`);
            
            const possibleIds = [
                unitId,
                unit.id,
                unit.id.replace(/_base$/, ''),
                unit.id.replace(/_evolved$/, ''),
                generateUnitId(unit.name),
                unit.name.toLowerCase().replace(/\s+/g, '')
            ];
            
            let evolutionInfo = null;
            let matchedId = null;
            
            for (const id of possibleIds) {
                if (mockEvolutionData[id]) {
                    evolutionInfo = mockEvolutionData[id];
                    matchedId = id;
                    break;
                }
            }
            
            if (evolutionInfo) {
                console.log(`✅ Found evolution data for ${unit.name} with ID: ${matchedId}`);
                return {
                    ...unit,
                    unitId: matchedId,
                    evolutionData: evolutionInfo,
                    evolutions: evolutionInfo.evolutions,
                    hasEvolutionData: true
                };
            }

            if (['Rare', 'Epic', 'Legendary', 'Mythic'].includes(unit.rarity)) {
                console.log(`⚠️ Unit ${unit.name} can evolve but no specific data found`);
                return {
                    ...unit,
                    unitId: unitId,
                    hasEvolutionData: false,
                    canEvolveByRarity: true
                };
            }

            console.log(`❌ No evolution data found for ${unit.name}`);
            return null;
        }

        // 测试Noruto数据
        window.testNorutoData = function() {
            const output = document.getElementById('debugOutput');
            output.innerHTML = '🧪 开始测试Noruto数据...\n\n';
            
            const unit = mockUnitsData[0];
            const unitId = generateUnitId(unit.name);
            
            output.innerHTML += `<span class="info">📋 单位信息:</span>\n`;
            output.innerHTML += `  - 名称: ${unit.name}\n`;
            output.innerHTML += `  - ID: ${unit.id}\n`;
            output.innerHTML += `  - 稀有度: ${unit.rarity}\n`;
            output.innerHTML += `  - 元素: ${unit.element}\n`;
            output.innerHTML += `  - 生成ID: ${unitId}\n\n`;
            
            output.innerHTML += `<span class="info">🔍 进化数据查找:</span>\n`;
            const evolutionInfo = lookupEvolutionData(unitId, unit);
            
            if (evolutionInfo) {
                output.innerHTML += `<span class="success">✅ 找到进化数据!</span>\n`;
                output.innerHTML += `  - Unit ID: ${evolutionInfo.unitId}\n`;
                output.innerHTML += `  - Has Evolution Data: ${evolutionInfo.hasEvolutionData}\n`;
                output.innerHTML += `  - Evolution Count: ${evolutionInfo.evolutions ? evolutionInfo.evolutions.length : 0}\n\n`;
                
                // 更新显示
                updateEvolutionDisplay(evolutionInfo);
            } else {
                output.innerHTML += `<span class="error">❌ 未找到进化数据</span>\n\n`;
            }
        };

        // 测试ID匹配
        window.testIdMatching = function() {
            const output = document.getElementById('debugOutput');
            output.innerHTML = '🔍 开始测试ID匹配...\n\n';
            
            const unit = mockUnitsData[0];
            const unitId = generateUnitId(unit.name);
            
            output.innerHTML += `<span class="info">🔑 ID匹配测试:</span>\n`;
            
            const possibleIds = [
                unitId,
                unit.id,
                unit.id.replace(/_base$/, ''),
                unit.id.replace(/_evolved$/, ''),
                generateUnitId(unit.name),
                unit.name.toLowerCase().replace(/\s+/g, '')
            ];
            
            possibleIds.forEach((id, index) => {
                const hasData = mockEvolutionData[id] !== undefined;
                const status = hasData ? '✅' : '❌';
                const color = hasData ? 'success' : 'error';
                
                output.innerHTML += `  ${status} 选择器 ${index + 1}: ${id}\n`;
                if (hasData) {
                    output.innerHTML += `    <span class="${color}">找到数据!</span>\n`;
                }
            });
            
            output.innerHTML += '\n';
        };

        // 测试进化数据
        window.testEvolutionData = function() {
            const output = document.getElementById('debugOutput');
            output.innerHTML = '📊 开始测试进化数据...\n\n';
            
            const norutoData = mockEvolutionData.noruto;
            
            if (norutoData) {
                output.innerHTML += `<span class="success">✅ Noruto进化数据:</span>\n`;
                output.innerHTML += `  - 名称: ${norutoData.name}\n`;
                output.innerHTML += `  - 稀有度: ${norutoData.rarity}\n`;
                output.innerHTML += `  - 元素: ${norutoData.element}\n`;
                output.innerHTML += `  - 进化阶段: ${norutoData.evolutions.length}\n\n`;
                
                norutoData.evolutions.forEach((evo, index) => {
                    output.innerHTML += `<span class="info">阶段 ${index + 1}: ${evo.name}</span>\n`;
                    output.innerHTML += `  - 属性倍数: ${evo.statMultiplier}x\n`;
                    output.innerHTML += `  - 等级要求: ${evo.requirements.level}\n`;
                    output.innerHTML += `  - 金币成本: ${evo.requirements.cost.toLocaleString()}\n`;
                    if (evo.requirements.gems > 0) {
                        output.innerHTML += `  - 宝石成本: ${evo.requirements.gems}\n`;
                    }
                    if (evo.requirements.materials.length > 0) {
                        output.innerHTML += `  - 材料: ${evo.requirements.materials.join(', ')}\n`;
                    }
                    output.innerHTML += '\n';
                });
            } else {
                output.innerHTML += `<span class="error">❌ 未找到Noruto进化数据</span>\n`;
            }
        };

        // 更新进化显示
        function updateEvolutionDisplay(evolutionInfo) {
            if (!evolutionInfo.hasEvolutionData) {
                document.getElementById('evolution-requirements').innerHTML = '<p>无进化数据</p>';
                return;
            }

            // Evolution Requirements
            const evoHtml = `
                <div class="evolution-requirements">
                    <h5>进化路径</h5>
                    ${evolutionInfo.evolutions.map((evo, index) => `
                        <div class="evolution-step">
                            <h5>${evo.name}</h5>
                            <p>属性倍数: ${evo.statMultiplier}x</p>
                            <p>等级要求: ${evo.requirements.level}</p>
                            <p>金币成本: ${evo.requirements.cost.toLocaleString()}</p>
                            ${evo.requirements.gems > 0 ? `<p>宝石成本: ${evo.requirements.gems}</p>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('evolution-requirements').innerHTML = evoHtml;

            // Cost Summary
            const totalCost = evolutionInfo.evolutions.reduce((sum, evo) => sum + evo.requirements.cost, 0);
            const totalGems = evolutionInfo.evolutions.reduce((sum, evo) => sum + evo.requirements.gems, 0);
            const totalMaterials = evolutionInfo.evolutions.reduce((sum, evo) => sum + evo.requirements.materials.length, 0);
            
            const costHtml = `
                <div class="cost-summary">
                    <h5>总成本</h5>
                    <p>金币: ${totalCost.toLocaleString()}</p>
                    <p>宝石: ${totalGems}</p>
                    <p>材料: ${totalMaterials}</p>
                </div>
            `;
            document.getElementById('cost-summary').innerHTML = costHtml;

            // Materials
            const allMaterials = new Map();
            evolutionInfo.evolutions.forEach(evo => {
                evo.requirements.materials.forEach(material => {
                    const [name, quantity] = material.split(' x');
                    const existing = allMaterials.get(name) || 0;
                    allMaterials.set(name, existing + parseInt(quantity || 1));
                });
            });

            const materialsHtml = `
                <div class="materials-list">
                    <h5>所需材料</h5>
                    ${Array.from(allMaterials.entries()).map(([name, quantity]) => `
                        <div class="material-item">
                            ${name} x${quantity}
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('evolution-materials').innerHTML = materialsHtml;

            // Farming Guide
            const farmingHtml = `
                <div class="farming-guide">
                    <h5>农场指南</h5>
                    <p>推荐农场方法:</p>
                    <ul>
                        <li>每日材料地下城</li>
                        <li>每周Boss挑战</li>
                        <li>月度传奇事件</li>
                    </ul>
                </div>
            `;
            document.getElementById('farming-guide').innerHTML = farmingHtml;
        }

        // 清除输出
        window.clearOutput = function() {
            document.getElementById('debugOutput').innerHTML = '点击测试按钮开始调试...';
            console.log('🗑️ 输出已清除');
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Noruto调试页面已加载');
            console.log('🧪 模拟数据已准备就绪');
            console.log('🔍 可以开始测试Noruto的进化数据');
        });
    </script>
</body>
</html>
