<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Evolution Calculator Test</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/pages/evolution.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #0f0f23;
            color: #ffffff;
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: #1a1a2e;
            padding: 20px;
            border-radius: 8px;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 5px; 
        }
        .test-title {
            color: #6c5ce7;
            margin-bottom: 15px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            background: #2a2a3e;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #444;
        }
        .test-card h4 {
            color: #6c5ce7;
            margin-bottom: 10px;
        }
        .test-result {
            padding: 8px;
            margin: 5px 0;
            border-radius: 3px;
            font-size: 0.9rem;
        }
        .test-pass {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            color: #28a745;
        }
        .test-fail {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            color: #dc3545;
        }
        .test-info {
            background: rgba(108, 92, 231, 0.2);
            border: 1px solid #6c5ce7;
            color: #6c5ce7;
        }
        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .filter-group label {
            font-weight: bold;
            color: #ddd;
        }
        .test-button {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #5a4fd8;
        }
        .run-all-btn {
            background: #28a745;
            font-size: 1.1rem;
            padding: 15px 30px;
        }
        .run-all-btn:hover {
            background: #218838;
        }
        .results-summary {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .summary-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(108, 92, 231, 0.1);
            border-radius: 5px;
            min-width: 100px;
        }
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #6c5ce7;
        }
        .stat-label {
            font-size: 0.8rem;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Comprehensive Evolution Calculator Test</h1>
        
        <div class="test-section">
            <h2 class="test-title">ğŸ¯ å…³é”®ç»„åˆæµ‹è¯•</h2>
            <p>æµ‹è¯•å¿…é¡»é€šè¿‡çš„å…³é”®ç¨€æœ‰åº¦+å…ƒç´ ç»„åˆ</p>
            
            <div class="test-grid">
                <div class="test-card">
                    <h4>Vanguard + Unknown</h4>
                    <p>åº”æ˜¾ç¤º: Song Jinwu and Igros</p>
                    <div id="test1-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest1()">è¿è¡Œæµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Secret + Cosmic</h4>
                    <p>åº”æ˜¾ç¤º: Yehowach (Almighty)</p>
                    <div id="test2-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest2()">è¿è¡Œæµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Secret + Blood</h4>
                    <p>åº”æ˜¾ç¤º: Alocard (Vampire King)</p>
                    <div id="test3-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest3()">è¿è¡Œæµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Mythic + Holy</h4>
                    <p>åº”æ˜¾ç¤º: Saber (King of Knights)</p>
                    <div id="test4-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest4()">è¿è¡Œæµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Exclusive + Spark</h4>
                    <p>åº”æ˜¾ç¤º: Luce (Hacker), Dawntay (Jackpot)</p>
                    <div id="test5-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest5()">è¿è¡Œæµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Legendary + ä»»æ„å…ƒç´ </h4>
                    <p>åº”æ˜¾ç¤º: No units available</p>
                    <div id="test6-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest6()">è¿è¡Œæµ‹è¯•</button>
                </div>
            </div>
            
            <button class="test-button run-all-btn" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">ğŸ” åŠŸèƒ½éªŒè¯æµ‹è¯•</h2>
            
            <div class="filter-section">
                <div class="filter-group">
                    <label for="testRarityFilter">Rarity:</label>
                    <select id="testRarityFilter" class="filter-select">
                        <option value="">All Rarity</option>
                        <option value="Vanguard">Vanguard</option>
                        <option value="Secret">Secret</option>
                        <option value="Exclusive">Exclusive</option>
                        <option value="Mythic">Mythic</option>
                        <option value="Legendary">Legendary</option>
                        <option value="Epic">Epic</option>
                        <option value="Rare">Rare</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="testElementFilter">Element:</label>
                    <select id="testElementFilter" class="filter-select">
                        <option value="">All Element</option>
                        <option value="Unknown">Unknown</option>
                        <option value="Cosmic">Cosmic</option>
                        <option value="Holy">Holy</option>
                        <option value="Fire">Fire</option>
                        <option value="Water">Water</option>
                        <option value="Nature">Nature</option>
                        <option value="Life">Life</option>
                        <option value="Spirit">Spirit</option>
                        <option value="Spark">Spark</option>
                        <option value="Passion">Passion</option>
                        <option value="Blood">Blood</option>
                        <option value="Shadow">Shadow</option>
                        <option value="Curse">Curse</option>
                        <option value="Earth">Earth</option>
                        <option value="Lightning">Lightning</option>
                        <option value="Dark">Dark</option>
                        <option value="Physical">Physical</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="testSearchInput">Search:</label>
                    <input type="text" id="testSearchInput" class="search-input" placeholder="Search units...">
                </div>
            </div>
            
            <div id="testResults" class="test-results"></div>
            <div id="unitCountDisplay" class="unit-count-display" style="display: none;"></div>
            
            <button class="test-button" onclick="testRarityOptions()">æµ‹è¯•ç¨€æœ‰åº¦é€‰é¡¹</button>
            <button class="test-button" onclick="testElementOptions()">æµ‹è¯•å…ƒç´ é€‰é¡¹</button>
            <button class="test-button" onclick="testAllRarityElement()">æµ‹è¯•All Rarity + All Element</button>
            <button class="test-button" onclick="clearTestFilters()">æ¸…é™¤ç­›é€‰</button>
        </div>
        
        <div class="results-summary">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœæ€»ç»“</h3>
            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">æ€»æµ‹è¯•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="passedTests">0</div>
                    <div class="stat-label">é€šè¿‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="failedTests">0</div>
                    <div class="stat-label">å¤±è´¥</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="successRate">0%</div>
                    <div class="stat-label">æˆåŠŸç‡</div>
                </div>
            </div>
            <div id="testLog"></div>
        </div>
    </div>

    <script type="module">
        import { EVOLUTION_UNITS, evolutionUtils } from './js/config/evolutionUnits.js';
        import { RARITIES, ELEMENTS, dataUtils } from './js/config/constants.js';

        // æµ‹è¯•çŠ¶æ€ç®¡ç†
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            tests: []
        };

        // ç­›é€‰é€»è¾‘å‡½æ•°ï¼ˆå¤åˆ¶è‡ªUnitSelectorï¼‰
        function filterEvolutionUnits(units, selectedRarity, selectedElement, searchTerm = '') {
            return units.filter(unit => {
                // 1. åªæ˜¾ç¤ºå¯è¿›åŒ–çš„ç¨€æœ‰åº¦
                const canEvolveRarities = ['Vanguard', 'Secret', 'Exclusive', 'Mythic'];
                if (!canEvolveRarities.includes(unit.rarity)) {
                    return false;
                }
                
                // 2. ç¡®ä¿å•ä½å¯ä»¥è¿›åŒ–
                if (unit.canEvolve !== true) {
                    return false;
                }
                
                // 3. ç¨€æœ‰åº¦åŒ¹é…
                if (selectedRarity && selectedRarity !== 'All Rarity' && unit.rarity !== selectedRarity) {
                    return false;
                }
                
                // 4. å…ƒç´ åŒ¹é…
                if (selectedElement && selectedElement !== 'All Element' && unit.element !== selectedElement) {
                    return false;
                }
                
                // 5. æœç´¢è¯åŒ¹é…
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    const nameMatch = unit.name.toLowerCase().includes(searchLower);
                    const evolutionMatch = unit.evolutionName.toLowerCase().includes(searchLower);
                    
                    if (!nameMatch && !evolutionMatch) {
                        return false;
                    }
                }
                
                return true;
            });
        }

        // æ›´æ–°æµ‹è¯•ç»Ÿè®¡
        function updateTestStats() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('successRate').textContent = 
                testResults.total > 0 ? `${Math.round((testResults.passed / testResults.total) * 100)}%` : '0%';
        }

        // æ·»åŠ æµ‹è¯•æ—¥å¿—
        function addTestLog(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const logEntry = document.createElement('div');
            logEntry.style.padding = '5px';
            logEntry.style.margin = '2px 0';
            logEntry.style.fontSize = '0.9rem';
            
            if (type === 'success') {
                logEntry.style.color = '#28a745';
            } else if (type === 'error') {
                logEntry.style.color = '#dc3545';
            } else {
                logEntry.style.color = '#6c5ce7';
            }
            
            logEntry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // è¿è¡Œå•ä¸ªæµ‹è¯•
        function runSingleTest(testName, rarity, element, expectedUnits, testId) {
            const filteredUnits = filterEvolutionUnits(EVOLUTION_UNITS, rarity, element, '');
            const resultDiv = document.getElementById(testId);
            
            let passed = false;
            let message = '';
            
            if (expectedUnits === 'none') {
                // æœŸæœ›æ²¡æœ‰å•ä½
                passed = filteredUnits.length === 0;
                message = passed ? 
                    `âœ… æ­£ç¡®ï¼šæ²¡æœ‰æ‰¾åˆ°å•ä½ï¼ˆæœŸæœ›ï¼šæ— å•ä½ï¼‰` : 
                    `âŒ é”™è¯¯ï¼šæ‰¾åˆ° ${filteredUnits.length} ä¸ªå•ä½ï¼ˆæœŸæœ›ï¼šæ— å•ä½ï¼‰`;
            } else {
                // æœŸæœ›ç‰¹å®šå•ä½
                const expectedUnitNames = Array.isArray(expectedUnits) ? expectedUnits : [expectedUnits];
                const foundUnitNames = filteredUnits.map(unit => unit.name);
                
                passed = expectedUnitNames.every(expected => 
                    foundUnitNames.some(found => found.includes(expected))
                );
                
                message = passed ? 
                    `âœ… æ­£ç¡®ï¼šæ‰¾åˆ°æœŸæœ›çš„å•ä½ ${expectedUnitNames.join(', ')}` : 
                    `âŒ é”™è¯¯ï¼šæœŸæœ› ${expectedUnitNames.join(', ')}ï¼Œå®é™…æ‰¾åˆ° ${foundUnitNames.join(', ')}`;
            }
            
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            resultDiv.textContent = message;
            
            // æ›´æ–°ç»Ÿè®¡
            testResults.total++;
            if (passed) {
                testResults.passed++;
                addTestLog(`âœ… ${testName}: é€šè¿‡`, 'success');
            } else {
                testResults.failed++;
                addTestLog(`âŒ ${testName}: å¤±è´¥`, 'error');
            }
            updateTestStats();
            
            return passed;
        }

        // æµ‹è¯•1: Vanguard + Unknown
        window.runTest1 = function() {
            runSingleTest(
                'Vanguard + Unknown',
                'Vanguard',
                'Unknown',
                'Song Jinwu and Igros',
                'test1-result'
            );
        };

        // æµ‹è¯•2: Secret + Cosmic
        window.runTest2 = function() {
            runSingleTest(
                'Secret + Cosmic',
                'Secret',
                'Cosmic',
                'Yehowach (Almighty)',
                'test2-result'
            );
        };

        // æµ‹è¯•3: Secret + Blood
        window.runTest3 = function() {
            runSingleTest(
                'Secret + Blood',
                'Secret',
                'Blood',
                'Alocard (Vampire King)',
                'test3-result'
            );
        };

        // æµ‹è¯•4: Mythic + Holy
        window.runTest4 = function() {
            runSingleTest(
                'Mythic + Holy',
                'Mythic',
                'Holy',
                'Saber (King of Knights)',
                'test4-result'
            );
        };

        // æµ‹è¯•5: Exclusive + Spark
        window.runTest5 = function() {
            runSingleTest(
                'Exclusive + Spark',
                'Exclusive',
                'Spark',
                ['Luce (Hacker)', 'Dawntay (Jackpot)'],
                'test5-result'
            );
        };

        // æµ‹è¯•6: Legendary + ä»»æ„å…ƒç´ 
        window.runTest6 = function() {
            runSingleTest(
                'Legendary + Fire',
                'Legendary',
                'Fire',
                'none',
                'test6-result'
            );
        };

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        window.runAllTests = function() {
            addTestLog('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'info');
            
            // é‡ç½®ç»Ÿè®¡
            testResults = { total: 0, passed: 0, failed: 0, tests: [] };
            updateTestStats();
            
            // è¿è¡Œæ‰€æœ‰æµ‹è¯•
            runTest1();
            runTest2();
            runTest3();
            runTest4();
            runTest5();
            runTest6();
            
            addTestLog(`ğŸ“Š æ‰€æœ‰æµ‹è¯•å®Œæˆï¼é€šè¿‡: ${testResults.passed}/${testResults.total}`, 
                testResults.failed === 0 ? 'success' : 'error');
        };

        // æµ‹è¯•ç¨€æœ‰åº¦é€‰é¡¹
        window.testRarityOptions = function() {
            addTestLog('ğŸ” æµ‹è¯•ç¨€æœ‰åº¦é€‰é¡¹...', 'info');
            
            const raritySelect = document.getElementById('testRarityFilter');
            const options = Array.from(raritySelect.options).slice(1);
            const expectedRarities = ['Vanguard', 'Secret', 'Exclusive', 'Mythic', 'Legendary', 'Epic', 'Rare'];
            
            const isCorrect = expectedRarities.every((rarity, index) => options[index]?.value === rarity);
            
            if (isCorrect) {
                addTestLog('âœ… ç¨€æœ‰åº¦é€‰é¡¹æ­£ç¡®', 'success');
            } else {
                addTestLog('âŒ ç¨€æœ‰åº¦é€‰é¡¹é”™è¯¯', 'error');
            }
        };

        // æµ‹è¯•å…ƒç´ é€‰é¡¹
        window.testElementOptions = function() {
            addTestLog('ğŸ” æµ‹è¯•å…ƒç´ é€‰é¡¹...', 'info');
            
            const elementSelect = document.getElementById('testElementFilter');
            const options = Array.from(elementSelect.options).slice(1);
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…éœ€çš„å…ƒç´ 
            const requiredElements = ['Unknown', 'Cosmic', 'Holy', 'Fire', 'Water', 'Nature', 'Life', 'Spirit', 'Spark', 'Passion', 'Blood', 'Shadow'];
            const foundElements = options.map(option => option.value);
            
            const missingElements = requiredElements.filter(element => !foundElements.includes(element));
            
            if (missingElements.length === 0) {
                addTestLog('âœ… å…ƒç´ é€‰é¡¹å®Œæ•´', 'success');
            } else {
                addTestLog(`âŒ ç¼ºå°‘å…ƒç´ : ${missingElements.join(', ')}`, 'error');
            }
        };

        // æµ‹è¯•All Rarity + All Element
        window.testAllRarityElement = function() {
            addTestLog('ğŸ” æµ‹è¯•All Rarity + All Element...', 'info');
            
            const filteredUnits = filterEvolutionUnits(EVOLUTION_UNITS, '', '', '');
            const countDisplay = document.getElementById('unitCountDisplay');
            
            countDisplay.style.display = 'block';
            countDisplay.innerHTML = `
                <div class="count-info">
                    <span class="count-text">Found ${filteredUnits.length} units matching your criteria</span>
                    <span class="count-detail">(${EVOLUTION_UNITS.length} total units available)</span>
                </div>
            `;
            
            addTestLog(`âœ… All Rarity + All Element: æ‰¾åˆ° ${filteredUnits.length} ä¸ªå•ä½`, 'success');
        };

        // æ¸…é™¤æµ‹è¯•ç­›é€‰
        window.clearTestFilters = function() {
            document.getElementById('testRarityFilter').value = '';
            document.getElementById('testElementFilter').value = '';
            document.getElementById('testSearchInput').value = '';
            document.getElementById('unitCountDisplay').style.display = 'none';
            addTestLog('ğŸ§¹ å·²æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶', 'info');
        };

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            addTestLog('ğŸš€ å…¨é¢æµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            addTestLog(`ğŸ“Š åŠ è½½äº† ${EVOLUTION_UNITS.length} ä¸ªè¿›åŒ–å•ä½`, 'info');
            updateTestStats();
        });
    </script>
</body>
</html> 