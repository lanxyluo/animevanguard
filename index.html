<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-H7C8MVNRR1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-H7C8MVNRR1');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Vanguards Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components/header.css">
    <link rel="stylesheet" href="css/components/cards.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/components/dropdowns.css">
    <link rel="stylesheet" href="css/pages/evolution.css">
    <link rel="stylesheet" href="css/pages/dps.css">
    <link rel="stylesheet" href="css/pages/database.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-calculator"></i> Anime Vanguards Calculator</h1>
            <p>Evolution Materials & DPS Calculator</p>
        </div>

        <div class="card">
            <h2><i class="fas fa-search"></i> Unit Selection</h2>
            <div class="unit-selector">
                <input type="text" id="unitSearch" placeholder="Search units...">
                <select id="rarityFilter">
                    <option value="">All Rarities</option>
                    <option value="Vanguard">Vanguard</option>
                    <option value="Secret">Secret</option>
                    <option value="Mythic">Mythic</option>
                </select>
                <select id="elementFilter">
                    <option value="">All Elements</option>
                    <option value="Fire">Fire</option>
                    <option value="Water">Water</option>
                    <option value="Cosmic">Cosmic</option>
                    <option value="Giant">Giant</option>
                </select>
            </div>

            <div id="unitPreview" class="unit-info">
                <div class="unit-avatar">
                    <i class="fas fa-question"></i>
                </div>
                <div>
                    <h3>No unit selected</h3>
                    <p>Select a unit to view details and calculate evolution materials</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-list"></i> Evolution Materials</h2>
            <div id="materialsList" class="materials-list">
                <p>Select a unit to view evolution materials</p>
            </div>
        </div>
    </div>

    <script type="module">
        // Import data modules
        import { unitsData } from './js/config/units.js';
        import { materialsConfig } from './js/config/materials.js';
        import { elementIcons } from './js/config/constants.js';
        
        // Import utility functions
        import { debounce, formatNumber, getElementColor } from './js/utils/helpers.js';
        import { showLoading, hideLoading, showError, showNotification } from './js/utils/dom.js';
        import { validateUnitData, validateMaterialsConfig, validateElementIcons } from './js/utils/validation.js';

        console.log('âœ… Data modules loaded successfully!');
        console.log('ðŸ“Š Units:', Object.keys(unitsData).length);
        console.log('ðŸ”§ Materials:', Object.keys(materialsConfig).length);
        console.log('ðŸŽ¨ Elements:', Object.keys(elementIcons).length);

        // DOM elements
        const unitSearch = document.getElementById('unitSearch');
        const rarityFilter = document.getElementById('rarityFilter');
        const elementFilter = document.getElementById('elementFilter');
        const unitPreview = document.getElementById('unitPreview');
        const materialsList = document.getElementById('materialsList');

        // Initialize
        function init() {
            console.log('ðŸš€ Initializing application...');
            
            // Validate data
            const unitValidation = validateUnitData(unitsData);
            const materialValidation = validateMaterialsConfig(materialsConfig);
            const iconValidation = validateElementIcons(elementIcons);
            
            if (!unitValidation.isValid) {
                console.error('âŒ Unit data validation failed:', unitValidation.errors);
                showError('Unit data validation failed', 'error');
            }
            
            if (!materialValidation.isValid) {
                console.error('âŒ Materials validation failed:', materialValidation.errors);
                showError('Materials validation failed', 'error');
            }
            
            if (!iconValidation.isValid) {
                console.error('âŒ Element icons validation failed:', iconValidation.errors);
                showError('Element icons validation failed', 'error');
            }
            
            // Set up event listeners with debounced search
            unitSearch.addEventListener('input', debounce(handleSearch, 300));
            rarityFilter.addEventListener('change', handleFilter);
            elementFilter.addEventListener('change', handleFilter);
            
            // Show first unit as example
            const firstUnit = Object.values(unitsData)[0];
            if (firstUnit) {
                selectUnit(firstUnit.id);
            }
            
            console.log('âœ… Application initialized!');
        }

        // Handle search
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            filterAndDisplayUnits(searchTerm);
        }

        // Handle filter
        function handleFilter() {
            const searchTerm = unitSearch.value.toLowerCase();
            filterAndDisplayUnits(searchTerm);
        }

        // Filter and display units
        function filterAndDisplayUnits(searchTerm) {
            const rarityFilterValue = rarityFilter.value;
            const elementFilterValue = elementFilter.value;
            
            const filteredUnits = Object.values(unitsData).filter(unit => {
                const matchesSearch = !searchTerm || 
                    unit.name.toLowerCase().includes(searchTerm) ||
                    unit.evolution.toLowerCase().includes(searchTerm);
                
                const matchesRarity = !rarityFilterValue || unit.rarity === rarityFilterValue;
                const matchesElement = !elementFilterValue || unit.element === elementFilterValue;
                
                return matchesSearch && matchesRarity && matchesElement;
            });

            // Display first filtered unit
            if (filteredUnits.length > 0) {
                selectUnit(filteredUnits[0].id);
            }
        }

        // Select unit
        function selectUnit(unitId) {
            const unit = unitsData[unitId];
            if (!unit) return;
            
            updateUnitCard(unit);
            updateMaterialsList(unit);
        }

        // Update unit card
        function updateUnitCard(unit) {
            unitPreview.innerHTML = `
                <div class="unit-avatar" style="background: ${getElementColor(unit.element)}">
                    <i class="${elementIcons[unit.element] || 'fas fa-question'}"></i>
                </div>
                <div>
                    <h3>${unit.name} (${unit.evolution})</h3>
                    <p><strong>${unit.rarity}</strong> â€¢ ${unit.element} â€¢ ${unit.type}</p>
                    <p>${unit.description}</p>
                </div>
            `;
        }

        // Update materials list
        function updateMaterialsList(unit) {
            if (!unit.evolutionMaterials) {
                materialsList.innerHTML = '<p>No evolution materials available</p>';
                return;
            }
            
            const { goldCost, specialItem, essenceStones } = unit.evolutionMaterials;
            let materialsHTML = '';
            
            if (goldCost) {
                materialsHTML += `
                    <div class="material-item">
                        <div>
                            <strong>Gold</strong>
                            <p>Basic currency for evolution</p>
                        </div>
                        <div>${formatNumber(goldCost)}</div>
                    </div>
                `;
            }
            
            if (specialItem) {
                const material = materialsConfig[specialItem.name];
                if (material) {
                    materialsHTML += `
                        <div class="material-item">
                            <div>
                                <strong>${specialItem.name}</strong>
                                <p>${material.description}</p>
                            </div>
                            <div>${material.rarity}</div>
                        </div>
                    `;
                }
            }
            
            if (essenceStones) {
                Object.entries(essenceStones).forEach(([name, quantity]) => {
                    const material = materialsConfig[name];
                    if (material) {
                        materialsHTML += `
                            <div class="material-item">
                                <div>
                                    <strong>${name}</strong>
                                    <p>${material.description}</p>
                                </div>
                                <div>${quantity}</div>
                            </div>
                        `;
                    }
                });
            }
            
            materialsList.innerHTML = materialsHTML;
        }



        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html> 