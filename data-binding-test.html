<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Binding Test</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/pages/evolution.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #0f0f23;
            color: #ffffff;
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: #1a1a2e;
            padding: 20px;
            border-radius: 8px;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 5px; 
        }
        .test-title {
            color: #6c5ce7;
            margin-bottom: 15px;
        }
        .component-display {
            background: #2a2a3e;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #444;
        }
        .test-button {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #5a4fd8;
        }
        .log-section {
            background: #2a2a3e;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .log-info { color: #6c5ce7; }
        .log-success { color: #28a745; }
        .log-error { color: #dc3545; }
        .log-warning { color: #ffc107; }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-connected { background: #28a745; }
        .status-disconnected { background: #dc3545; }
        .status-pending { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Data Binding Test</h1>
        
        <div class="test-section">
            <h2 class="test-title">ğŸ”— æ•°æ®ç»‘å®šæµ‹è¯•</h2>
            <p>æµ‹è¯•é€‰ä¸­å•ä½æ­£ç¡®è§¦å‘å³ä¾§é¢æ¿æ›´æ–°</p>
            
            <div class="test-section">
                <h3>ğŸ® æµ‹è¯•æ“ä½œ</h3>
                <button class="test-button" onclick="testDataBinding()">æµ‹è¯•æ•°æ®ç»‘å®š</button>
                <button class="test-button" onclick="testComponentCommunication()">æµ‹è¯•ç»„ä»¶é€šä¿¡</button>
                <button class="test-button" onclick="testStateManagement()">æµ‹è¯•çŠ¶æ€ç®¡ç†</button>
                <button class="test-button" onclick="clearTestLog()">æ¸…é™¤æ—¥å¿—</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">ğŸ“ è°ƒè¯•æ—¥å¿—</h2>
            <div id="testLog" class="log-section">
                <div class="log-entry log-info">ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">ğŸ”— ç»„ä»¶çŠ¶æ€</h2>
            <div id="componentStatus" class="component-display">
                <h4>ç»„ä»¶è¿æ¥çŠ¶æ€:</h4>
                <div id="statusDisplay">
                    <p><span class="status-indicator status-disconnected"></span>UnitSelector: æœªè¿æ¥</p>
                    <p><span class="status-indicator status-disconnected"></span>MaterialsList: æœªè¿æ¥</p>
                    <p><span class="status-indicator status-disconnected"></span>CostSummary: æœªè¿æ¥</p>
                    <p><span class="status-indicator status-disconnected"></span>FarmingGuide: æœªè¿æ¥</p>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2 class="test-title">ğŸ“Š æ•°æ®æµè¿½è¸ª</h2>
            <div id="dataFlowDisplay" class="component-display">
                <h4>æ•°æ®æµ:</h4>
                <div id="dataFlow">
                    <p>ç­‰å¾…æ•°æ®æµ...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { EVOLUTION_UNITS } from './js/config/evolutionUnits.js';
        import { EVOLUTION_MATERIALS_DATA } from './js/config/evolutionMaterials.js';
        import { COST_SUMMARY_DATA } from './js/config/costSummary.js';
        import { FARMING_GUIDE_DATA } from './js/config/farmingGuide.js';

        let testLog = [];
        let componentStatus = {
            unitSelector: false,
            materialsList: false,
            costSummary: false,
            farmingGuide: false
        };
        let dataFlow = [];

        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                timestamp,
                message,
                type
            };
            testLog.push(logEntry);
            
            const logDiv = document.getElementById('testLog');
            const logElement = document.createElement('div');
            logElement.className = `log-entry log-${type}`;
            logElement.innerHTML = `[${timestamp}] ${message}`;
            logDiv.appendChild(logElement);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // æ›´æ–°ç»„ä»¶çŠ¶æ€æ˜¾ç¤º
        function updateComponentStatus() {
            const statusDisplay = document.getElementById('statusDisplay');
            statusDisplay.innerHTML = `
                <p><span class="status-indicator ${componentStatus.unitSelector ? 'status-connected' : 'status-disconnected'}"></span>UnitSelector: ${componentStatus.unitSelector ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}</p>
                <p><span class="status-indicator ${componentStatus.materialsList ? 'status-connected' : 'status-disconnected'}"></span>MaterialsList: ${componentStatus.materialsList ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}</p>
                <p><span class="status-indicator ${componentStatus.costSummary ? 'status-connected' : 'status-disconnected'}"></span>CostSummary: ${componentStatus.costSummary ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}</p>
                <p><span class="status-indicator ${componentStatus.farmingGuide ? 'status-connected' : 'status-disconnected'}"></span>FarmingGuide: ${componentStatus.farmingGuide ? 'å·²è¿æ¥' : 'æœªè¿æ¥'}</p>
            `;
        }

        // æ›´æ–°æ•°æ®æµæ˜¾ç¤º
        function updateDataFlow() {
            const dataFlowDisplay = document.getElementById('dataFlow');
            if (dataFlow.length === 0) {
                dataFlowDisplay.innerHTML = '<p>ç­‰å¾…æ•°æ®æµ...</p>';
                return;
            }

            let flowHTML = '';
            dataFlow.forEach((flow, index) => {
                flowHTML += `
                    <div style="margin: 10px 0; padding: 8px; background: rgba(108, 92, 231, 0.1); border-radius: 3px;">
                        <strong>${index + 1}. ${flow.from} â†’ ${flow.to}</strong><br>
                        <small>æ•°æ®: ${flow.data}</small><br>
                        <small>æ—¶é—´: ${flow.timestamp}</small>
                    </div>
                `;
            });
            dataFlowDisplay.innerHTML = flowHTML;
        }

        // æ¨¡æ‹Ÿæ•°æ®ç»‘å®šæµ‹è¯•
        window.testDataBinding = function() {
            addLog('ğŸ”— å¼€å§‹æµ‹è¯•æ•°æ®ç»‘å®š...', 'info');
            
            // æ¨¡æ‹Ÿé€‰æ‹©å•ä½
            const testUnit = EVOLUTION_UNITS[0];
            addLog(`ğŸ¯ é€‰æ‹©æµ‹è¯•å•ä½: ${testUnit.name}`, 'success');
            
            // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
            const materialsData = EVOLUTION_MATERIALS_DATA[testUnit.id];
            const costData = COST_SUMMARY_DATA[testUnit.id];
            const farmingData = FARMING_GUIDE_DATA[testUnit.id];
            
            addLog(`ğŸ“¦ åŠ è½½ææ–™æ•°æ®: ${materialsData ? 'æˆåŠŸ' : 'å¤±è´¥'}`, materialsData ? 'success' : 'error');
            addLog(`ğŸ’° åŠ è½½æˆæœ¬æ•°æ®: ${costData ? 'æˆåŠŸ' : 'å¤±è´¥'}`, costData ? 'success' : 'error');
            addLog(`ğŸŒ¾ åŠ è½½å†œåœºæ•°æ®: ${farmingData ? 'æˆåŠŸ' : 'å¤±è´¥'}`, farmingData ? 'success' : 'error');
            
            // è®°å½•æ•°æ®æµ
            dataFlow.push({
                from: 'UnitSelector',
                to: 'EvolutionPage',
                data: testUnit.name,
                timestamp: new Date().toLocaleTimeString()
            });
            
            if (materialsData) {
                dataFlow.push({
                    from: 'EvolutionPage',
                    to: 'MaterialsList',
                    data: 'Materials Data',
                    timestamp: new Date().toLocaleTimeString()
                });
            }
            
            if (costData) {
                dataFlow.push({
                    from: 'EvolutionPage',
                    to: 'CostSummary',
                    data: 'Cost Data',
                    timestamp: new Date().toLocaleTimeString()
                });
            }
            
            if (farmingData) {
                dataFlow.push({
                    from: 'EvolutionPage',
                    to: 'FarmingGuide',
                    data: 'Farming Data',
                    timestamp: new Date().toLocaleTimeString()
                });
            }
            
            updateDataFlow();
            addLog('âœ… æ•°æ®ç»‘å®šæµ‹è¯•å®Œæˆ', 'success');
        };

        // æµ‹è¯•ç»„ä»¶é€šä¿¡
        window.testComponentCommunication = function() {
            addLog('ğŸ“ å¼€å§‹æµ‹è¯•ç»„ä»¶é€šä¿¡...', 'info');
            
            // æ¨¡æ‹Ÿç»„ä»¶è¿æ¥
            componentStatus.unitSelector = true;
            componentStatus.materialsList = true;
            componentStatus.costSummary = true;
            componentStatus.farmingGuide = true;
            
            updateComponentStatus();
            
            addLog('âœ… UnitSelector å·²è¿æ¥', 'success');
            addLog('âœ… MaterialsList å·²è¿æ¥', 'success');
            addLog('âœ… CostSummary å·²è¿æ¥', 'success');
            addLog('âœ… FarmingGuide å·²è¿æ¥', 'success');
            
            // æ¨¡æ‹Ÿé€šä¿¡æµ‹è¯•
            setTimeout(() => {
                addLog('ğŸ“¡ æ¨¡æ‹Ÿå•ä½é€‰æ‹©äº‹ä»¶...', 'info');
                addLog('ğŸ“¡ æ¨¡æ‹Ÿæ•°æ®ä¼ é€’...', 'info');
                addLog('ğŸ“¡ æ¨¡æ‹Ÿç»„ä»¶æ›´æ–°...', 'info');
                addLog('âœ… ç»„ä»¶é€šä¿¡æµ‹è¯•å®Œæˆ', 'success');
            }, 1000);
        };

        // æµ‹è¯•çŠ¶æ€ç®¡ç†
        window.testStateManagement = function() {
            addLog('ğŸ”„ å¼€å§‹æµ‹è¯•çŠ¶æ€ç®¡ç†...', 'info');
            
            // æ¨¡æ‹ŸçŠ¶æ€å˜åŒ–
            const states = [
                { unit: null, description: 'åˆå§‹çŠ¶æ€ - æ— é€‰ä¸­å•ä½' },
                { unit: EVOLUTION_UNITS[0], description: 'é€‰æ‹©ç¬¬ä¸€ä¸ªå•ä½' },
                { unit: EVOLUTION_UNITS[1], description: 'åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªå•ä½' },
                { unit: null, description: 'æ¸…é™¤é€‰æ‹©' }
            ];
            
            states.forEach((state, index) => {
                setTimeout(() => {
                    if (state.unit) {
                        addLog(`ğŸ”„ çŠ¶æ€å˜åŒ– ${index + 1}: ${state.description} - ${state.unit.name}`, 'info');
                    } else {
                        addLog(`ğŸ”„ çŠ¶æ€å˜åŒ– ${index + 1}: ${state.description}`, 'info');
                    }
                    
                    // æ¨¡æ‹Ÿç»„ä»¶çŠ¶æ€æ›´æ–°
                    if (state.unit) {
                        addLog(`ğŸ“¦ æ›´æ–°ææ–™åˆ—è¡¨: ${state.unit.name}`, 'success');
                        addLog(`ğŸ’° æ›´æ–°æˆæœ¬æ±‡æ€»: ${state.unit.name}`, 'success');
                        addLog(`ğŸŒ¾ æ›´æ–°å†œåœºæŒ‡å—: ${state.unit.name}`, 'success');
                    } else {
                        addLog(`ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰ç»„ä»¶æ•°æ®`, 'warning');
                    }
                }, index * 500);
            });
            
            setTimeout(() => {
                addLog('âœ… çŠ¶æ€ç®¡ç†æµ‹è¯•å®Œæˆ', 'success');
            }, states.length * 500 + 500);
        };

        // æ¸…é™¤æµ‹è¯•æ—¥å¿—
        window.clearTestLog = function() {
            document.getElementById('testLog').innerHTML = '<div class="log-entry log-info">æ—¥å¿—å·²æ¸…é™¤</div>';
            testLog = [];
            dataFlow = [];
            updateDataFlow();
        };

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            addLog('ğŸš€ æ•°æ®ç»‘å®šæµ‹è¯•é¡µé¢å·²åŠ è½½', 'info');
            addLog(`ğŸ“Š åŠ è½½äº† ${EVOLUTION_UNITS.length} ä¸ªè¿›åŒ–å•ä½`, 'info');
            addLog(`ğŸ“¦ åŠ è½½äº† ${Object.keys(EVOLUTION_MATERIALS_DATA).length} ä¸ªææ–™æ•°æ®`, 'info');
            addLog(`ğŸ’° åŠ è½½äº† ${Object.keys(COST_SUMMARY_DATA).length} ä¸ªæˆæœ¬æ•°æ®`, 'info');
            addLog(`ğŸŒ¾ åŠ è½½äº† ${Object.keys(FARMING_GUIDE_DATA).length} ä¸ªå†œåœºæŒ‡å—`, 'info');
            
            updateComponentStatus();
            updateDataFlow();
        });
    </script>
</body>
</html> 