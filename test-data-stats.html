<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Stats Test - Anime Vanguards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #6c5ce7;
        }
        .stat-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .stat-item:last-child {
            border-bottom: none;
        }
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #27ae60;
            background: #f0f9f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a4fcf;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Anime Vanguards æ•°æ®ç»Ÿè®¡æµ‹è¯•</h1>
        <p>æ­¤é¡µé¢ç”¨äºéªŒè¯é¡¹ç›®æ•°æ®å®Œæ•´æ€§å’Œç»Ÿè®¡ä¿¡æ¯ã€‚</p>
        
        <div>
            <button onclick="loadAndAnalyze()">ğŸ”„ åŠ è½½å¹¶åˆ†ææ•°æ®</button>
            <button onclick="validateData()">âœ… éªŒè¯æ•°æ®å®Œæ•´æ€§</button>
            <button onclick="findDuplicates()">ğŸ” æŸ¥æ‰¾é‡å¤æ•°æ®</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        </div>

        <div id="results"></div>
    </div>

    <script type="module">
        import { DataStats } from './js/utils/dataStats.js';
        
        let dataStats = null;
        
        async function loadAndAnalyze() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>â³ æ­£åœ¨åŠ è½½æ•°æ®...</p>';
            
            try {
                dataStats = new DataStats();
                const loaded = await dataStats.loadData();
                
                if (loaded) {
                    dataStats.printReport();
                    displayStats();
                } else {
                    resultsDiv.innerHTML = '<div class="error">âŒ æ•°æ®åŠ è½½å¤±è´¥</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `<div class="error">âŒ é”™è¯¯: ${error.message}</div>`;
            }
        }
        
        function displayStats() {
            const resultsDiv = document.getElementById('results');
            const stats = dataStats.getBasicStats();
            
            if (!stats) {
                resultsDiv.innerHTML = '<div class="error">âŒ æ— æ³•è·å–ç»Ÿè®¡æ•°æ®</div>';
                return;
            }
            
            let html = '<div class="stats-grid">';
            
            // åŸºæœ¬ç»Ÿè®¡
            html += `
                <div class="stat-card">
                    <div class="stat-title">ğŸ“ˆ åŸºæœ¬ç»Ÿè®¡</div>
                    <div class="stat-item">
                        <span>æ€»è§’è‰²æ•°</span>
                        <span>${stats.totalUnits}</span>
                    </div>
                    <div class="stat-item">
                        <span>æ•°æ®åº“è§’è‰²æ•°</span>
                        <span>${stats.databaseUnits}</span>
                    </div>
                </div>
            `;
            
            // ç¨€æœ‰åº¦åˆ†å¸ƒ
            html += `
                <div class="stat-card">
                    <div class="stat-title">ğŸ¯ ç¨€æœ‰åº¦åˆ†å¸ƒ</div>
            `;
            Object.entries(stats.rarityDistribution).forEach(([rarity, count]) => {
                html += `<div class="stat-item"><span>${rarity}</span><span>${count}ä¸ª</span></div>`;
            });
            html += '</div>';
            
            // å¼ºåº¦åˆ†å¸ƒ
            html += `
                <div class="stat-card">
                    <div class="stat-title">â­ å¼ºåº¦åˆ†å¸ƒ</div>
            `;
            Object.entries(stats.tierDistribution).forEach(([tier, count]) => {
                html += `<div class="stat-item"><span>${tier}</span><span>${count}ä¸ª</span></div>`;
            });
            html += '</div>';
            
            // å…ƒç´ åˆ†å¸ƒ
            html += `
                <div class="stat-card">
                    <div class="stat-title">ğŸ”¥ å…ƒç´ åˆ†å¸ƒ</div>
            `;
            Object.entries(stats.elementDistribution).forEach(([element, count]) => {
                html += `<div class="stat-item"><span>${element}</span><span>${count}ä¸ª</span></div>`;
            });
            html += '</div>';
            
            // ç±»å‹åˆ†å¸ƒ
            html += `
                <div class="stat-card">
                    <div class="stat-title">âš”ï¸ ç±»å‹åˆ†å¸ƒ</div>
            `;
            Object.entries(stats.typeDistribution).forEach(([type, count]) => {
                html += `<div class="stat-item"><span>${type}</span><span>${count}ä¸ª</span></div>`;
            });
            html += '</div>';
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
        
        function validateData() {
            if (!dataStats) {
                document.getElementById('results').innerHTML = '<div class="error">âŒ è¯·å…ˆåŠ è½½æ•°æ®</div>';
                return;
            }
            
            const validation = dataStats.validateData();
            const resultsDiv = document.getElementById('results');
            
            if (validation.valid) {
                resultsDiv.innerHTML = `
                    <div class="success">
                        âœ… æ•°æ®éªŒè¯é€šè¿‡<br>
                        æ€»è§’è‰²æ•°: ${validation.totalUnits}<br>
                        æ•°æ®åº“è§’è‰²æ•°: ${validation.databaseUnits}
                    </div>
                `;
            } else {
                let html = '<div class="error">âŒ æ•°æ®éªŒè¯å¤±è´¥ï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜:</div><ul>';
                validation.errors.forEach(error => {
                    html += `<li>${error}</li>`;
                });
                html += '</ul>';
                resultsDiv.innerHTML = html;
            }
        }
        
        function findDuplicates() {
            if (!dataStats) {
                document.getElementById('results').innerHTML = '<div class="error">âŒ è¯·å…ˆåŠ è½½æ•°æ®</div>';
                return;
            }
            
            const duplicates = dataStats.findDuplicates();
            const resultsDiv = document.getElementById('results');
            
            if (duplicates.length === 0) {
                resultsDiv.innerHTML = '<div class="success">âœ… æœªå‘ç°é‡å¤æ•°æ®</div>';
            } else {
                let html = '<div class="error">âŒ å‘ç°é‡å¤æ•°æ®:</div><ul>';
                duplicates.forEach(duplicate => {
                    html += `<li>${duplicate}</li>`;
                });
                html += '</ul>';
                resultsDiv.innerHTML = html;
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // å…¨å±€å‡½æ•°
        window.loadAndAnalyze = loadAndAnalyze;
        window.validateData = validateData;
        window.findDuplicates = findDuplicates;
        window.clearResults = clearResults;
    </script>
</body>
</html>
