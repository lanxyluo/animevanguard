<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Stats Test - Anime Vanguards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #6c5ce7;
        }
        .stat-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .stat-item:last-child {
            border-bottom: none;
        }
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #27ae60;
            background: #f0f9f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a4fcf;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📊 Anime Vanguards 数据统计测试</h1>
        <p>此页面用于验证项目数据完整性和统计信息。</p>
        
        <div>
            <button onclick="loadAndAnalyze()">🔄 加载并分析数据</button>
            <button onclick="validateData()">✅ 验证数据完整性</button>
            <button onclick="findDuplicates()">🔍 查找重复数据</button>
            <button onclick="clearResults()">🗑️ 清除结果</button>
        </div>

        <div id="results"></div>
    </div>

    <script type="module">
        import { DataStats } from './js/utils/dataStats.js';
        
        let dataStats = null;
        
        async function loadAndAnalyze() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>⏳ 正在加载数据...</p>';
            
            try {
                dataStats = new DataStats();
                const loaded = await dataStats.loadData();
                
                if (loaded) {
                    dataStats.printReport();
                    displayStats();
                } else {
                    resultsDiv.innerHTML = '<div class="error">❌ 数据加载失败</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `<div class="error">❌ 错误: ${error.message}</div>`;
            }
        }
        
        function displayStats() {
            const resultsDiv = document.getElementById('results');
            const stats = dataStats.getBasicStats();
            
            if (!stats) {
                resultsDiv.innerHTML = '<div class="error">❌ 无法获取统计数据</div>';
                return;
            }
            
            let html = '<div class="stats-grid">';
            
            // 基本统计
            html += `
                <div class="stat-card">
                    <div class="stat-title">📈 基本统计</div>
                    <div class="stat-item">
                        <span>总角色数</span>
                        <span>${stats.totalUnits}</span>
                    </div>
                    <div class="stat-item">
                        <span>数据库角色数</span>
                        <span>${stats.databaseUnits}</span>
                    </div>
                </div>
            `;
            
            // 稀有度分布
            html += `
                <div class="stat-card">
                    <div class="stat-title">🎯 稀有度分布</div>
            `;
            Object.entries(stats.rarityDistribution).forEach(([rarity, count]) => {
                html += `<div class="stat-item"><span>${rarity}</span><span>${count}个</span></div>`;
            });
            html += '</div>';
            
            // 强度分布
            html += `
                <div class="stat-card">
                    <div class="stat-title">⭐ 强度分布</div>
            `;
            Object.entries(stats.tierDistribution).forEach(([tier, count]) => {
                html += `<div class="stat-item"><span>${tier}</span><span>${count}个</span></div>`;
            });
            html += '</div>';
            
            // 元素分布
            html += `
                <div class="stat-card">
                    <div class="stat-title">🔥 元素分布</div>
            `;
            Object.entries(stats.elementDistribution).forEach(([element, count]) => {
                html += `<div class="stat-item"><span>${element}</span><span>${count}个</span></div>`;
            });
            html += '</div>';
            
            // 类型分布
            html += `
                <div class="stat-card">
                    <div class="stat-title">⚔️ 类型分布</div>
            `;
            Object.entries(stats.typeDistribution).forEach(([type, count]) => {
                html += `<div class="stat-item"><span>${type}</span><span>${count}个</span></div>`;
            });
            html += '</div>';
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
        
        function validateData() {
            if (!dataStats) {
                document.getElementById('results').innerHTML = '<div class="error">❌ 请先加载数据</div>';
                return;
            }
            
            const validation = dataStats.validateData();
            const resultsDiv = document.getElementById('results');
            
            if (validation.valid) {
                resultsDiv.innerHTML = `
                    <div class="success">
                        ✅ 数据验证通过<br>
                        总角色数: ${validation.totalUnits}<br>
                        数据库角色数: ${validation.databaseUnits}
                    </div>
                `;
            } else {
                let html = '<div class="error">❌ 数据验证失败，发现以下问题:</div><ul>';
                validation.errors.forEach(error => {
                    html += `<li>${error}</li>`;
                });
                html += '</ul>';
                resultsDiv.innerHTML = html;
            }
        }
        
        function findDuplicates() {
            if (!dataStats) {
                document.getElementById('results').innerHTML = '<div class="error">❌ 请先加载数据</div>';
                return;
            }
            
            const duplicates = dataStats.findDuplicates();
            const resultsDiv = document.getElementById('results');
            
            if (duplicates.length === 0) {
                resultsDiv.innerHTML = '<div class="success">✅ 未发现重复数据</div>';
            } else {
                let html = '<div class="error">❌ 发现重复数据:</div><ul>';
                duplicates.forEach(duplicate => {
                    html += `<li>${duplicate}</li>`;
                });
                html += '</ul>';
                resultsDiv.innerHTML = html;
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // 全局函数
        window.loadAndAnalyze = loadAndAnalyze;
        window.validateData = validateData;
        window.findDuplicates = findDuplicates;
        window.clearResults = clearResults;
    </script>
</body>
</html>
