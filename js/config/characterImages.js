// Character Images Configuration
// Maps character IDs to their avatar images

export const characterImages = {
  // META DEFINING Characters - Official Wiki Characters
  "the-falcon-of-light": {
    avatar: "images/characters/the-falcon-of-light.png",
    fallback: "https://via.placeholder.com/64x64/f1c40f/ffffff?text=FAL"
  },
  "koguro-unsealed": {
    avatar: "images/characters/koguro-unsealed.png",
    fallback: "https://via.placeholder.com/64x64/2c3e50/ffffff?text=KOG"
  },
  "iscanur-pride": {
    avatar: "images/characters/iscanur-pride.png",
    fallback: "https://via.placeholder.com/64x64/e74c3c/ffffff?text=ISC"
  },
  "the-struggler-rampage": {
    avatar: "images/characters/the-struggler-rampage.png",
    fallback: "https://via.placeholder.com/64x64/8b4513/ffffff?text=STR"
  },
  "the-king-apostle": {
    avatar: "images/characters/the-king-apostle.png",
    fallback: "https://via.placeholder.com/64x64/1a1a1a/ffffff?text=KING"
  },
  "smith-john": {
    avatar: "images/characters/smith-john.png",
    fallback: "https://via.placeholder.com/64x64/95a5a6/ffffff?text=JOHN"
  },
  "song-jinwu-and-igros": {
    avatar: "images/characters/song-jinwu-and-igros.png",
    fallback: "https://via.placeholder.com/64x64/8e44ad/ffffff?text=SJI"
  },
  
  // Existing META DEFINING Characters
  "divalo-requiem": {
    avatar: "images/characters/divalo-requiem.png",
    fallback: "https://via.placeholder.com/64x64/9b59b6/ffffff?text=DIO"
  },
  "igros-elite-knight": {
    avatar: "images/characters/igros-elite-knight.png", 
    fallback: "https://via.placeholder.com/64x64/2c3e50/ffffff?text=IGR"
  },
  "gujo-infinity": {
    avatar: "images/characters/gujo-infinity.png",
    fallback: "https://via.placeholder.com/64x64/3498db/ffffff?text=GUJO"
  },
  "sukono": {
    avatar: "images/characters/sukono.png",
    fallback: "https://via.placeholder.com/64x64/e74c3c/ffffff?text=SUK"
  },
  "madara-ultimate": {
    avatar: "images/characters/madara-ultimate.png",
    fallback: "https://via.placeholder.com/64x64/c0392b/ffffff?text=MAD"
  },

  // STRONG PICK Characters  
  "song-jinwu-monarch": {
    avatar: "images/characters/song-jinwu-monarch.png",
    fallback: "https://via.placeholder.com/64x64/8e44ad/ffffff?text=SJW"
  },
  "akazo-destructive": {
    avatar: "images/characters/akazo-destructive.png",
    fallback: "https://via.placeholder.com/64x64/e67e22/ffffff?text=AKA"
  },
  "cha-in-blade-dancer": {
    avatar: "images/characters/cha-in-blade-dancer.png",
    fallback: "https://via.placeholder.com/64x64/27ae60/ffffff?text=CHA"
  },
  "alocard-vampire-king": {
    avatar: "images/characters/alocard-vampire-king.png",
    fallback: "https://via.placeholder.com/64x64/8b0000/ffffff?text=ALC"
  },
  "jag-o-volcanic": {
    avatar: "images/characters/jag-o-volcanic.png",
    fallback: "https://via.placeholder.com/64x64/d35400/ffffff?text=JAG"
  },
  "chaso-blood-curse": {
    avatar: "images/characters/chaso-blood-curse.png",
    fallback: "https://via.placeholder.com/64x64/922b21/ffffff?text=CHA"
  },
  "noruto-six-tails": {
    avatar: "images/characters/noruto-six-tails.png",
    fallback: "https://via.placeholder.com/64x64/f39c12/ffffff?text=NAR"
  },
  "obita-awakened": {
    avatar: "images/characters/obita-awakened.png",
    fallback: "https://via.placeholder.com/64x64/34495e/ffffff?text=OBI"
  },
  "yehowach-almighty": {
    avatar: "images/characters/yehowach-almighty.png",
    fallback: "https://via.placeholder.com/64x64/f1c40f/ffffff?text=YEH"
  },
  "tanjiro-hinokami": {
    avatar: "images/characters/tanjiro-hinokami.png",
    fallback: "https://via.placeholder.com/64x64/e74c3c/ffffff?text=TAN"
  },
  "zenitsu-god-speed": {
    avatar: "images/characters/zenitsu-god-speed.png",
    fallback: "https://via.placeholder.com/64x64/f1c40f/ffffff?text=ZEN"
  },
  "giyu-water-hashira": {
    avatar: "images/characters/giyu-water-hashira.png",
    fallback: "https://via.placeholder.com/64x64/3498db/ffffff?text=GIY"
  },
  "kakashi-copy-ninja": {
    avatar: "images/characters/kakashi-copy-ninja.png",
    fallback: "https://via.placeholder.com/64x64/95a5a6/ffffff?text=KAK"
  },
  "itachi-akatsuki": {
    avatar: "images/characters/itachi-akatsuki.png",
    fallback: "https://via.placeholder.com/64x64/2c3e50/ffffff?text=ITA"
  },
  "minato-yellow-flash": {
    avatar: "images/characters/minato-yellow-flash.png",
    fallback: "https://via.placeholder.com/64x64/f39c12/ffffff?text=MIN"
  },
  "luffy-gear-5": {
    avatar: "images/characters/luffy-gear-5.png",
    fallback: "https://via.placeholder.com/64x64/e74c3c/ffffff?text=LUF"
  },
  "zoro-king-hell": {
    avatar: "images/characters/zoro-king-hell.png",
    fallback: "https://via.placeholder.com/64x64/27ae60/ffffff?text=ZOR"
  },
  "ichigo-bankai": {
    avatar: "images/characters/ichigo-bankai.png",
    fallback: "https://via.placeholder.com/64x64/e67e22/ffffff?text=ICH"
  },
  "aizen-sosuke": {
    avatar: "images/characters/aizen-sosuke.png",
    fallback: "https://via.placeholder.com/64x64/8e44ad/ffffff?text=AIZ"
  },

  // SOLID Characters
  "whitebeard-prime": {
    avatar: "images/characters/whitebeard-prime.png",
    fallback: "https://via.placeholder.com/64x64/ecf0f1/ffffff?text=WB"
  },
  "haruka-rin-dancer": {
    avatar: "images/characters/haruka-rin-dancer.png",
    fallback: "https://via.placeholder.com/64x64/e91e63/ffffff?text=HAR"
  },
  "super-brolzi": {
    avatar: "images/characters/super-brolzi.png",
    fallback: "https://via.placeholder.com/64x64/f39c12/ffffff?text=BRO"
  },
  "tengon-flashiness": {
    avatar: "images/characters/tengon-flashiness.png",
    fallback: "https://via.placeholder.com/64x64/9b59b6/ffffff?text=TEN"
  },
  "sosuke-storm": {
    avatar: "images/characters/sosuke-storm.png",
    fallback: "https://via.placeholder.com/64x64/3498db/ffffff?text=SOS"
  },
  "sprintwagon": {
    avatar: "images/characters/sprintwagon.png",
    fallback: "https://via.placeholder.com/64x64/f1c40f/ffffff?text=SPR"
  }
};

// 生成本地头像（避免网络请求）
function generateLocalAvatar(characterId) {
  // 使用 data URL 生成简单的文字头像
  const initials = characterId.substring(0, 3).toUpperCase();
  const colors = [
    '#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', 
    '#1abc9c', '#e67e22', '#34495e', '#95a5a6', '#f1c40f'
  ];
  
  // 根据 characterId 生成一致的颜色
  const colorIndex = characterId.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0) % colors.length;
  const bgColor = colors[colorIndex];
  
  // 创建 SVG 头像
  const svg = `
    <svg width="64" height="64" xmlns="http://www.w3.org/2000/svg">
      <rect width="64" height="64" fill="${bgColor}"/>
      <text x="32" y="40" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white" text-anchor="middle">${initials}</text>
    </svg>
  `;
  
  return `data:image/svg+xml;base64,${btoa(svg)}`;
}

// Function to get character image with fallback
export function getCharacterImage(characterId) {
  const imageData = characterImages[characterId];
  if (!imageData) {
    // 使用本地 fallback，避免网络请求
    return generateLocalAvatar(characterId);
  }
  
  // 直接使用生成的头像，避免网络请求
  return generateLocalAvatar(characterId);
}

// Function to check if image exists
export async function checkImageExists(imagePath) {
  try {
    const response = await fetch(imagePath, { method: 'HEAD' });
    return response.ok;
  } catch {
    return false;
  }
}