<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Calculator Test Suite</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0f0f23; color: #ffffff; }
        .container { max-width: 1200px; margin: 0 auto; background: #1a1a2e; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .test-card { background: #2a2a3e; padding: 15px; border-radius: 5px; border: 1px solid #444; }
        .test-result { padding: 8px; margin: 5px 0; border-radius: 3px; font-size: 0.9rem; }
        .test-pass { background: rgba(40, 167, 69, 0.2); border: 1px solid #28a745; color: #28a745; }
        .test-fail { background: rgba(220, 53, 69, 0.2); border: 1px solid #dc3545; color: #dc3545; }
        .test-info { background: rgba(108, 92, 231, 0.2); border: 1px solid #6c5ce7; color: #6c5ce7; }
        .test-button { background: #6c5ce7; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .run-all-btn { background: #28a745; font-size: 1.1rem; padding: 15px 30px; }
        .summary-stats { display: flex; gap: 20px; margin-bottom: 15px; }
        .stat-item { text-align: center; padding: 10px; background: rgba(108, 92, 231, 0.1); border-radius: 5px; min-width: 100px; }
        .stat-number { font-size: 1.5rem; font-weight: bold; color: #6c5ce7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Evolution Calculator Test Suite</h1>
        
        <div class="test-section">
            <h2>ğŸ¯ å…³é”®ç»„åˆæµ‹è¯•</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h4>Vanguard + Unknown</h4>
                    <p>åº”æ˜¾ç¤º: Song Jinwu and Igros</p>
                    <div id="test1-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest1()">æµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Secret + Cosmic</h4>
                    <p>åº”æ˜¾ç¤º: Yehowach (Almighty)</p>
                    <div id="test2-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest2()">æµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Secret + Blood</h4>
                    <p>åº”æ˜¾ç¤º: Alocard (Vampire King)</p>
                    <div id="test3-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest3()">æµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Mythic + Holy</h4>
                    <p>åº”æ˜¾ç¤º: Saber (King of Knights)</p>
                    <div id="test4-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest4()">æµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Exclusive + Spark</h4>
                    <p>åº”æ˜¾ç¤º: Luce (Hacker), Dawntay (Jackpot)</p>
                    <div id="test5-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest5()">æµ‹è¯•</button>
                </div>
                
                <div class="test-card">
                    <h4>Legendary + Fire</h4>
                    <p>åº”æ˜¾ç¤º: No units available</p>
                    <div id="test6-result" class="test-result test-info">ç­‰å¾…æµ‹è¯•...</div>
                    <button class="test-button" onclick="runTest6()">æµ‹è¯•</button>
                </div>
            </div>
            
            <button class="test-button run-all-btn" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š æµ‹è¯•ç»“æœæ€»ç»“</h2>
            <div class="summary-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalTests">0</div>
                    <div>æ€»æµ‹è¯•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="passedTests">0</div>
                    <div>é€šè¿‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="failedTests">0</div>
                    <div>å¤±è´¥</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="successRate">0%</div>
                    <div>æˆåŠŸç‡</div>
                </div>
            </div>
            <div id="testLog"></div>
        </div>
    </div>

    <script type="module">
        import { EVOLUTION_UNITS } from './js/config/evolutionUnits.js';

        let testResults = { total: 0, passed: 0, failed: 0 };

        function filterEvolutionUnits(units, selectedRarity, selectedElement, searchTerm = '') {
            return units.filter(unit => {
                const canEvolveRarities = ['Vanguard', 'Secret', 'Exclusive', 'Mythic'];
                if (!canEvolveRarities.includes(unit.rarity)) return false;
                if (unit.canEvolve !== true) return false;
                
                if (selectedRarity && selectedRarity !== 'All Rarity' && unit.rarity !== selectedRarity) return false;
                if (selectedElement && selectedElement !== 'All Element' && unit.element !== selectedElement) return false;
                
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    const nameMatch = unit.name.toLowerCase().includes(searchLower);
                    const evolutionMatch = unit.evolutionName.toLowerCase().includes(searchLower);
                    if (!nameMatch && !evolutionMatch) return false;
                }
                
                return true;
            });
        }

        function updateTestStats() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            document.getElementById('successRate').textContent = 
                testResults.total > 0 ? `${Math.round((testResults.passed / testResults.total) * 100)}%` : '0%';
        }

        function addTestLog(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const logEntry = document.createElement('div');
            logEntry.style.padding = '5px';
            logEntry.style.margin = '2px 0';
            logEntry.style.fontSize = '0.9rem';
            logEntry.style.color = type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#6c5ce7';
            logEntry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function runSingleTest(testName, rarity, element, expectedUnits, testId) {
            const filteredUnits = filterEvolutionUnits(EVOLUTION_UNITS, rarity, element, '');
            const resultDiv = document.getElementById(testId);
            
            let passed = false;
            let message = '';
            
            if (expectedUnits === 'none') {
                passed = filteredUnits.length === 0;
                message = passed ? 
                    `âœ… æ­£ç¡®ï¼šæ²¡æœ‰æ‰¾åˆ°å•ä½` : 
                    `âŒ é”™è¯¯ï¼šæ‰¾åˆ° ${filteredUnits.length} ä¸ªå•ä½`;
            } else {
                const expectedUnitNames = Array.isArray(expectedUnits) ? expectedUnits : [expectedUnits];
                const foundUnitNames = filteredUnits.map(unit => unit.name);
                
                passed = expectedUnitNames.every(expected => 
                    foundUnitNames.some(found => found.includes(expected))
                );
                
                message = passed ? 
                    `âœ… æ­£ç¡®ï¼šæ‰¾åˆ°æœŸæœ›çš„å•ä½` : 
                    `âŒ é”™è¯¯ï¼šæœŸæœ› ${expectedUnitNames.join(', ')}ï¼Œå®é™…æ‰¾åˆ° ${foundUnitNames.join(', ')}`;
            }
            
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            resultDiv.textContent = message;
            
            testResults.total++;
            if (passed) {
                testResults.passed++;
                addTestLog(`âœ… ${testName}: é€šè¿‡`, 'success');
            } else {
                testResults.failed++;
                addTestLog(`âŒ ${testName}: å¤±è´¥`, 'error');
            }
            updateTestStats();
            
            return passed;
        }

        window.runTest1 = () => runSingleTest('Vanguard + Unknown', 'Vanguard', 'Unknown', 'Song Jinwu and Igros', 'test1-result');
        window.runTest2 = () => runSingleTest('Secret + Cosmic', 'Secret', 'Cosmic', 'Yehowach (Almighty)', 'test2-result');
        window.runTest3 = () => runSingleTest('Secret + Blood', 'Secret', 'Blood', 'Alocard (Vampire King)', 'test3-result');
        window.runTest4 = () => runSingleTest('Mythic + Holy', 'Mythic', 'Holy', 'Saber (King of Knights)', 'test4-result');
        window.runTest5 = () => runSingleTest('Exclusive + Spark', 'Exclusive', 'Spark', ['Luce (Hacker)', 'Dawntay (Jackpot)'], 'test5-result');
        window.runTest6 = () => runSingleTest('Legendary + Fire', 'Legendary', 'Fire', 'none', 'test6-result');

        window.runAllTests = function() {
            addTestLog('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'info');
            testResults = { total: 0, passed: 0, failed: 0 };
            updateTestStats();
            
            runTest1();
            runTest2();
            runTest3();
            runTest4();
            runTest5();
            runTest6();
            
            addTestLog(`ğŸ“Š æ‰€æœ‰æµ‹è¯•å®Œæˆï¼é€šè¿‡: ${testResults.passed}/${testResults.total}`, 
                testResults.failed === 0 ? 'success' : 'error');
        };

        window.addEventListener('load', function() {
            addTestLog('ğŸš€ æµ‹è¯•å¥—ä»¶å·²åŠ è½½', 'info');
            addTestLog(`ğŸ“Š åŠ è½½äº† ${EVOLUTION_UNITS.length} ä¸ªè¿›åŒ–å•ä½`, 'info');
            updateTestStats();
        });
    </script>
</body>
</html> 