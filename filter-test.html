<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Filter Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .filter-controls { display: flex; gap: 15px; margin-bottom: 20px; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-group select, .filter-group input { padding: 8px; border: 1px solid #ccc; }
        .unit-card { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 5px 0; }
        .console-output { background: #000; color: #0f0; padding: 15px; font-family: monospace; max-height: 300px; overflow-y: auto; }
        .test-button { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Evolution Filter Test</h1>
        
        <div class="test-section">
            <h2>筛选控制</h2>
            <div class="filter-controls">
                <div class="filter-group">
                    <label>稀有度:</label>
                    <select id="testRarityFilter">
                        <option value="">All Rarity</option>
                        <option value="Vanguard">Vanguard</option>
                        <option value="Secret">Secret</option>
                        <option value="Exclusive">Exclusive</option>
                        <option value="Mythic">Mythic</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>元素:</label>
                    <select id="testElementFilter">
                        <option value="">All Element</option>
                        <option value="Unknown">Unknown</option>
                        <option value="Cosmic">Cosmic</option>
                        <option value="Fire">Fire</option>
                        <option value="Shadow">Shadow</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>搜索:</label>
                    <input type="text" id="testSearchInput" placeholder="搜索单位名称...">
                </div>
            </div>
            
            <button class="test-button" onclick="runFilterTest()">运行筛选测试</button>
            <button class="test-button" onclick="clearFilters()">清除筛选</button>
        </div>
        
        <div class="test-section">
            <h2>筛选结果</h2>
            <div id="filterResults"></div>
        </div>
        
        <div class="test-section">
            <h2>控制台输出</h2>
            <div id="consoleOutput" class="console-output"></div>
        </div>
    </div>

    <script type="module">
        import { EVOLUTION_UNITS } from './js/config/evolutionUnits.js';

        // 模拟控制台输出
        const originalConsoleLog = console.log;
        const consoleOutput = document.getElementById('consoleOutput');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // 筛选逻辑函数
        function filterEvolutionUnits(units, selectedRarity, selectedElement, searchTerm = '') {
            return units.filter(unit => {
                // 1. 只显示可进化的稀有度
                const canEvolveRarities = ['Vanguard', 'Secret', 'Exclusive', 'Mythic'];
                if (!canEvolveRarities.includes(unit.rarity)) {
                    console.log(`❌ 过滤掉 ${unit.name}: 稀有度 ${unit.rarity} 不可进化`);
                    return false;
                }
                
                // 2. 确保单位可以进化
                if (unit.canEvolve !== true) {
                    console.log(`❌ 过滤掉 ${unit.name}: canEvolve = ${unit.canEvolve}`);
                    return false;
                }
                
                // 3. 稀有度匹配
                if (selectedRarity && selectedRarity !== 'All Rarity' && unit.rarity !== selectedRarity) {
                    console.log(`❌ 过滤掉 ${unit.name}: 稀有度不匹配 (${unit.rarity} !== ${selectedRarity})`);
                    return false;
                }
                
                // 4. 元素匹配
                if (selectedElement && selectedElement !== 'All Element' && unit.element !== selectedElement) {
                    console.log(`❌ 过滤掉 ${unit.name}: 元素不匹配 (${unit.element} !== ${selectedElement})`);
                    return false;
                }
                
                // 5. 搜索词匹配
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    const nameMatch = unit.name.toLowerCase().includes(searchLower);
                    const evolutionMatch = unit.evolutionName.toLowerCase().includes(searchLower);
                    
                    if (!nameMatch && !evolutionMatch) {
                        console.log(`❌ 过滤掉 ${unit.name}: 搜索词不匹配 "${searchTerm}"`);
                        return false;
                    }
                }
                
                // 6. 通过所有筛选条件
                console.log(`✅ 保留 ${unit.name}: 通过所有筛选条件`);
                return true;
            });
        }

        // 运行筛选测试
        window.runFilterTest = function() {
            console.log('🔍 === 开始筛选测试 ===');
            
            const rarityFilter = document.getElementById('testRarityFilter').value;
            const elementFilter = document.getElementById('testElementFilter').value;
            const searchTerm = document.getElementById('testSearchInput').value;
            
            console.log(`📊 筛选前单位总数: ${EVOLUTION_UNITS.length}`);
            console.log('🎯 当前筛选条件:', { 
                searchTerm: searchTerm || '无', 
                rarityFilter: rarityFilter || 'All Rarity', 
                elementFilter: elementFilter || 'All Element' 
            });
            
            const filteredUnits = filterEvolutionUnits(EVOLUTION_UNITS, rarityFilter, elementFilter, searchTerm);
            
            console.log(`📊 筛选后单位数量: ${filteredUnits.length}`);
            console.log(`📈 筛选效率: ${((filteredUnits.length / EVOLUTION_UNITS.length) * 100).toFixed(1)}%`);
            
            // 显示筛选结果
            const filterResults = document.getElementById('filterResults');
            filterResults.innerHTML = '';
            
            if (filteredUnits.length > 0) {
                console.log('✅ 筛选结果详情:');
                filteredUnits.forEach((unit, index) => {
                    console.log(`  ${index + 1}. ${unit.name} (${unit.rarity}, ${unit.element}) → ${unit.evolutionName}`);
                    
                    const unitCard = document.createElement('div');
                    unitCard.className = 'unit-card';
                    unitCard.innerHTML = `
                        <strong>${unit.name}</strong> (${unit.rarity}, ${unit.element})<br>
                        → ${unit.evolutionName}<br>
                        <small>${unit.obtainMethod}</small>
                    `;
                    filterResults.appendChild(unitCard);
                });
            } else {
                console.log('❌ 没有找到匹配的单位');
                filterResults.innerHTML = '<p style="color: #dc3545;">❌ 没有找到匹配的单位</p>';
            }
            
            console.log('🔍 === 筛选测试结束 ===\n');
        };

        // 清除筛选
        window.clearFilters = function() {
            document.getElementById('testRarityFilter').value = '';
            document.getElementById('testElementFilter').value = '';
            document.getElementById('testSearchInput').value = '';
            runFilterTest();
        };

        // 页面加载时运行初始测试
        window.addEventListener('load', function() {
            console.log('🚀 Evolution Filter Test 页面已加载');
            console.log(`📊 加载了 ${EVOLUTION_UNITS.length} 个进化单位`);
            runFilterTest();
        });
    </script>
</body>
</html> 