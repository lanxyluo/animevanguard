<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolution Filter Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .filter-controls { display: flex; gap: 15px; margin-bottom: 20px; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-group select, .filter-group input { padding: 8px; border: 1px solid #ccc; }
        .unit-card { background: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 5px 0; }
        .console-output { background: #000; color: #0f0; padding: 15px; font-family: monospace; max-height: 300px; overflow-y: auto; }
        .test-button { background: #007bff; color: white; border: none; padding: 10px 20px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Evolution Filter Test</h1>
        
        <div class="test-section">
            <h2>ç­›é€‰æ§åˆ¶</h2>
            <div class="filter-controls">
                <div class="filter-group">
                    <label>ç¨€æœ‰åº¦:</label>
                    <select id="testRarityFilter">
                        <option value="">All Rarity</option>
                        <option value="Vanguard">Vanguard</option>
                        <option value="Secret">Secret</option>
                        <option value="Exclusive">Exclusive</option>
                        <option value="Mythic">Mythic</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>å…ƒç´ :</label>
                    <select id="testElementFilter">
                        <option value="">All Element</option>
                        <option value="Unknown">Unknown</option>
                        <option value="Cosmic">Cosmic</option>
                        <option value="Fire">Fire</option>
                        <option value="Shadow">Shadow</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>æœç´¢:</label>
                    <input type="text" id="testSearchInput" placeholder="æœç´¢å•ä½åç§°...">
                </div>
            </div>
            
            <button class="test-button" onclick="runFilterTest()">è¿è¡Œç­›é€‰æµ‹è¯•</button>
            <button class="test-button" onclick="clearFilters()">æ¸…é™¤ç­›é€‰</button>
        </div>
        
        <div class="test-section">
            <h2>ç­›é€‰ç»“æœ</h2>
            <div id="filterResults"></div>
        </div>
        
        <div class="test-section">
            <h2>æ§åˆ¶å°è¾“å‡º</h2>
            <div id="consoleOutput" class="console-output"></div>
        </div>
    </div>

    <script type="module">
        import { EVOLUTION_UNITS } from './js/config/evolutionUnits.js';

        // æ¨¡æ‹Ÿæ§åˆ¶å°è¾“å‡º
        const originalConsoleLog = console.log;
        const consoleOutput = document.getElementById('consoleOutput');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };

        // ç­›é€‰é€»è¾‘å‡½æ•°
        function filterEvolutionUnits(units, selectedRarity, selectedElement, searchTerm = '') {
            return units.filter(unit => {
                // 1. åªæ˜¾ç¤ºå¯è¿›åŒ–çš„ç¨€æœ‰åº¦
                const canEvolveRarities = ['Vanguard', 'Secret', 'Exclusive', 'Mythic'];
                if (!canEvolveRarities.includes(unit.rarity)) {
                    console.log(`âŒ è¿‡æ»¤æ‰ ${unit.name}: ç¨€æœ‰åº¦ ${unit.rarity} ä¸å¯è¿›åŒ–`);
                    return false;
                }
                
                // 2. ç¡®ä¿å•ä½å¯ä»¥è¿›åŒ–
                if (unit.canEvolve !== true) {
                    console.log(`âŒ è¿‡æ»¤æ‰ ${unit.name}: canEvolve = ${unit.canEvolve}`);
                    return false;
                }
                
                // 3. ç¨€æœ‰åº¦åŒ¹é…
                if (selectedRarity && selectedRarity !== 'All Rarity' && unit.rarity !== selectedRarity) {
                    console.log(`âŒ è¿‡æ»¤æ‰ ${unit.name}: ç¨€æœ‰åº¦ä¸åŒ¹é… (${unit.rarity} !== ${selectedRarity})`);
                    return false;
                }
                
                // 4. å…ƒç´ åŒ¹é…
                if (selectedElement && selectedElement !== 'All Element' && unit.element !== selectedElement) {
                    console.log(`âŒ è¿‡æ»¤æ‰ ${unit.name}: å…ƒç´ ä¸åŒ¹é… (${unit.element} !== ${selectedElement})`);
                    return false;
                }
                
                // 5. æœç´¢è¯åŒ¹é…
                if (searchTerm) {
                    const searchLower = searchTerm.toLowerCase();
                    const nameMatch = unit.name.toLowerCase().includes(searchLower);
                    const evolutionMatch = unit.evolutionName.toLowerCase().includes(searchLower);
                    
                    if (!nameMatch && !evolutionMatch) {
                        console.log(`âŒ è¿‡æ»¤æ‰ ${unit.name}: æœç´¢è¯ä¸åŒ¹é… "${searchTerm}"`);
                        return false;
                    }
                }
                
                // 6. é€šè¿‡æ‰€æœ‰ç­›é€‰æ¡ä»¶
                console.log(`âœ… ä¿ç•™ ${unit.name}: é€šè¿‡æ‰€æœ‰ç­›é€‰æ¡ä»¶`);
                return true;
            });
        }

        // è¿è¡Œç­›é€‰æµ‹è¯•
        window.runFilterTest = function() {
            console.log('ğŸ” === å¼€å§‹ç­›é€‰æµ‹è¯• ===');
            
            const rarityFilter = document.getElementById('testRarityFilter').value;
            const elementFilter = document.getElementById('testElementFilter').value;
            const searchTerm = document.getElementById('testSearchInput').value;
            
            console.log(`ğŸ“Š ç­›é€‰å‰å•ä½æ€»æ•°: ${EVOLUTION_UNITS.length}`);
            console.log('ğŸ¯ å½“å‰ç­›é€‰æ¡ä»¶:', { 
                searchTerm: searchTerm || 'æ— ', 
                rarityFilter: rarityFilter || 'All Rarity', 
                elementFilter: elementFilter || 'All Element' 
            });
            
            const filteredUnits = filterEvolutionUnits(EVOLUTION_UNITS, rarityFilter, elementFilter, searchTerm);
            
            console.log(`ğŸ“Š ç­›é€‰åå•ä½æ•°é‡: ${filteredUnits.length}`);
            console.log(`ğŸ“ˆ ç­›é€‰æ•ˆç‡: ${((filteredUnits.length / EVOLUTION_UNITS.length) * 100).toFixed(1)}%`);
            
            // æ˜¾ç¤ºç­›é€‰ç»“æœ
            const filterResults = document.getElementById('filterResults');
            filterResults.innerHTML = '';
            
            if (filteredUnits.length > 0) {
                console.log('âœ… ç­›é€‰ç»“æœè¯¦æƒ…:');
                filteredUnits.forEach((unit, index) => {
                    console.log(`  ${index + 1}. ${unit.name} (${unit.rarity}, ${unit.element}) â†’ ${unit.evolutionName}`);
                    
                    const unitCard = document.createElement('div');
                    unitCard.className = 'unit-card';
                    unitCard.innerHTML = `
                        <strong>${unit.name}</strong> (${unit.rarity}, ${unit.element})<br>
                        â†’ ${unit.evolutionName}<br>
                        <small>${unit.obtainMethod}</small>
                    `;
                    filterResults.appendChild(unitCard);
                });
            } else {
                console.log('âŒ æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å•ä½');
                filterResults.innerHTML = '<p style="color: #dc3545;">âŒ æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å•ä½</p>';
            }
            
            console.log('ğŸ” === ç­›é€‰æµ‹è¯•ç»“æŸ ===\n');
        };

        // æ¸…é™¤ç­›é€‰
        window.clearFilters = function() {
            document.getElementById('testRarityFilter').value = '';
            document.getElementById('testElementFilter').value = '';
            document.getElementById('testSearchInput').value = '';
            runFilterTest();
        };

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œåˆå§‹æµ‹è¯•
        window.addEventListener('load', function() {
            console.log('ğŸš€ Evolution Filter Test é¡µé¢å·²åŠ è½½');
            console.log(`ğŸ“Š åŠ è½½äº† ${EVOLUTION_UNITS.length} ä¸ªè¿›åŒ–å•ä½`);
            runFilterTest();
        });
    </script>
</body>
</html> 